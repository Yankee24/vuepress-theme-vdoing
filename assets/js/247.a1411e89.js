(window.webpackJsonp=window.webpackJsonp||[]).push([[247],{749:function(a,t,s){"use strict";s.r(t);var e=s(21),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),s("p",[a._v("文末附下载方式")])]),a._v(" "),s("h3",{attrs:{id:"_1-各组件版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-各组件版本"}},[a._v("#")]),a._v(" 1. 各组件版本")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[a._v("组件")]),a._v(" "),s("th",{staticStyle:{"text-align":"center"}},[a._v("版本")])])]),a._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[a._v("elasticseach")]),a._v(" "),s("td",{staticStyle:{"text-align":"center"}},[a._v("7.13.0")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[a._v("kibana")]),a._v(" "),s("td",{staticStyle:{"text-align":"center"}},[a._v("7.13.0")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[a._v("logstash")]),a._v(" "),s("td",{staticStyle:{"text-align":"center"}},[a._v("7.13.0")])]),a._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[a._v("flink")]),a._v(" "),s("td",{staticStyle:{"text-align":"center"}},[a._v("1.13.6")])])])]),a._v(" "),s("h3",{attrs:{id:"_2-flink日志文件配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-flink日志文件配置"}},[a._v("#")]),a._v(" 2. Flink日志文件配置")]),a._v(" "),s("h4",{attrs:{id:"_2-1-设置日志按大小滚动生成文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-设置日志按大小滚动生成文件"}},[a._v("#")]),a._v(" 2.1 设置日志按大小滚动生成文件")]),a._v(" "),s("p",[a._v("因为在正常的情况下，Flink的流数据是非常大的，有时候会使用print()打印数据自己查看，有时候为了查找问题会开启debug日志，就会导致日志文件非常大，通过Web UI查看对应的日志文件是会非常卡，所以首先将日志文件按照大小滚动生成文件，我们在查看时不会因为某个文件非常大导致Web UI界面卡，没法查看。")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Allows this configuration to be modified at runtime. The file will be checked every 30 seconds.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("monitorInterval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("30")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# This affects logging for both user code and Flink")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("rootLogger.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("INFO")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("rootLogger.appenderRef.file.ref")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("RollingFileAppender")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Uncomment this if you want to _only_ change Flink's logging")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#logger.flink.name = org.apache.flink")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#logger.flink.level = INFO")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# The following lines keep the log level of common libraries/connectors on")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# log level INFO. The root logger does not override this. You have to manually")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# change the log levels here.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.akka.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("akka")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.akka.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("INFO")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.kafka.name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("org.apache.kafka")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.kafka.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("INFO")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.hadoop.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("org.apache.hadoop")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.hadoop.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("INFO")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.zookeeper.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("org.apache.zookeeper")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.zookeeper.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("INFO")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.shaded_zookeeper.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("org.apache.flink.shaded.zookeeper3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.shaded_zookeeper.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("INFO")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Log all infos in the given file")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("RollingFileAppender")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("RollingFile")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.append")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("false")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.fileName")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("${sys:log.file}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.filePattern")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("${sys:log.file}.%i")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.layout.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PatternLayout")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.layout.pattern")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %-60c %x - %m%n")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.policies.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Policies")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.policies.size.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("SizeBasedTriggeringPolicy")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.policies.size.size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("500MB")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.strategy.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("DefaultRolloverStrategy")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.strategy.max")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("10")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Suppress the irrelevant (wrong) warnings from the Netty channel handler")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.netty.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.netty.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("OFF")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br")])]),s("h4",{attrs:{id:"_2-2-设置日志写入kafka集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-设置日志写入kafka集群"}},[a._v("#")]),a._v(" 2.2 设置日志写入Kafka集群")]),a._v(" "),s("p",[a._v("针对按照日志文件大小滚动生成文件的方式，可能因为某个错误的问题，需要看好多个日志文件，所以可以把日志文件通过KafkaAppender写入到kafka中，然后通过ELK等进行日志搜索甚至是分析告警。")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Allows this configuration to be modified at runtime. The file will be checked every 30 seconds.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("monitorInterval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("30")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# This affects logging for both user code and Flink")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("rootLogger.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("INFO")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("rootLogger.appenderRef.kafka.ref")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Kafka")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("rootLogger.appenderRef.file.ref")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("RollingFileAppender")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Uncomment this if you want to _only_ change Flink's logging")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#logger.flink.name = org.apache.flink")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#logger.flink.level = INFO")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# The following lines keep the log level of common libraries/connectors on")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# log level INFO. The root logger does not override this. You have to manually")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# change the log levels here.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.akka.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("akka")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.akka.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("INFO")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.kafka.name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("org.apache.kafka")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.kafka.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("INFO")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.hadoop.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("org.apache.hadoop")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.hadoop.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("INFO")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.zookeeper.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("org.apache.zookeeper")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.zookeeper.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("INFO")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.shaded_zookeeper.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("org.apache.flink.shaded.zookeeper3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.shaded_zookeeper.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("INFO")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Log all infos in the given file")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("RollingFileAppender")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("RollingFile")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.append")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("false")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.fileName")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("${sys:log.file}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.filePattern")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("${sys:log.file}.%i")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.layout.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PatternLayout")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.layout.pattern")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %-60c %x - %m%n")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.policies.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Policies")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.policies.size.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("SizeBasedTriggeringPolicy")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.policies.size.size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("500MB")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.strategy.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("DefaultRolloverStrategy")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.rolling.strategy.max")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("10")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kafka")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Kafka")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Kafka")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.syncSend")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.ignoreExceptions")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("false")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.topic")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("flink_logs")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.property.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Property")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.property.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("bootstrap.servers")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.property.value")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("localhost:9092")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("JSONLayout")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("apender.kafka.layout.value")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("net.logstash.log4j.JSONEventLayoutV1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.compact")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.complete")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("false")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#appender.kafka.layout.additionalField1.type = KeyValuePair")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#appender.kafka.layout.additionalField1.key = logdir")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#appender.kafka.layout.additionalField1.value = ${sys:log.file}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#appender.kafka.layout.additionalField2.type = KeyValuePair")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#appender.kafka.layout.additionalField2.key = flink_job_name")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#appender.kafka.layout.additionalField2.value = ${sys:flink_job_name}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#appender.kafka.layout.additionalField3.type = KeyValuePair")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#appender.kafka.layout.additionalField3.key = yarnContainerId")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#appender.kafka.layout.additionalField3.value = ${sys:yarnContainerId}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Suppress the irrelevant (wrong) warnings from the Netty channel handler")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.netty.name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("logger.netty.level")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("OFF")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br"),s("span",{staticClass:"line-number"},[a._v("46")]),s("br"),s("span",{staticClass:"line-number"},[a._v("47")]),s("br"),s("span",{staticClass:"line-number"},[a._v("48")]),s("br"),s("span",{staticClass:"line-number"},[a._v("49")]),s("br"),s("span",{staticClass:"line-number"},[a._v("50")]),s("br"),s("span",{staticClass:"line-number"},[a._v("51")]),s("br"),s("span",{staticClass:"line-number"},[a._v("52")]),s("br"),s("span",{staticClass:"line-number"},[a._v("53")]),s("br"),s("span",{staticClass:"line-number"},[a._v("54")]),s("br"),s("span",{staticClass:"line-number"},[a._v("55")]),s("br"),s("span",{staticClass:"line-number"},[a._v("56")]),s("br"),s("span",{staticClass:"line-number"},[a._v("57")]),s("br"),s("span",{staticClass:"line-number"},[a._v("58")]),s("br"),s("span",{staticClass:"line-number"},[a._v("59")]),s("br"),s("span",{staticClass:"line-number"},[a._v("60")]),s("br"),s("span",{staticClass:"line-number"},[a._v("61")]),s("br"),s("span",{staticClass:"line-number"},[a._v("62")]),s("br"),s("span",{staticClass:"line-number"},[a._v("63")]),s("br"),s("span",{staticClass:"line-number"},[a._v("64")]),s("br"),s("span",{staticClass:"line-number"},[a._v("65")]),s("br"),s("span",{staticClass:"line-number"},[a._v("66")]),s("br")])]),s("p",[a._v("上面的"),s("code",[a._v("appender.kafka.layout.type")]),a._v("可以使用"),s("code",[a._v("JSONLayout")]),a._v("，也可以自定义。自定义需要将上面的"),s("code",[a._v("appender.kafka.layout.type")]),a._v("和"),s("code",[a._v("appender.kafka.layout.value")]),a._v("修改成如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PatternLayout")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.pattern")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('{"log_level":"%p","log_timestamp":"%d{ISO8601}","log_thread":"%t","log_file":"%F","log_line":"%L","log_message":"\'%m\'","log_path":"%X{log_path}","job_name":"${sys:flink_job_name}"}%n')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("针对于不同的Flink模式，需要在"),s("code",[a._v("flink/lib")]),a._v("目录下放入的jar包也有所不同：")]),a._v(" "),s("h5",{attrs:{id:"_2-2-1-flink-on-yarn"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-flink-on-yarn"}},[a._v("#")]),a._v(" 2.2.1 Flink on Yarn")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 根据kafka的版本放入kafka-clients")]),a._v("\nkafka-clients-3.1.0.jar\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("如果是通过"),s("code",[a._v("flink on yarn")]),a._v("模式还可以添加自定义字段：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 日志路径")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.additionalField1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("KeyValuePair")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.additionalField1.key")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("logdir")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.additionalField1.value")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("${sys:log.file}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# flink-job-name")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.additionalField2.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("KeyValuePair")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.additionalField2.key")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("flinkJobName")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.additionalField2.value")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("${sys:flinkJobName}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 提交到yarn的containerId")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.additionalField3.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("KeyValuePair")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.additionalField3.key")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("yarnContainerId")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appender.kafka.layout.additionalField3.value")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("${sys:yarnContainerId}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("p",[a._v("添加以上的自定义字段，需要在"),s("code",[a._v("flink-conf.yaml")]),a._v("中配置如下：")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("env.java.opts.taskmanager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("DyarnContainerId=$CONTAINER_ID\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("env.java.opts.jobmanager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("DyarnContainerId=$CONTAINER_ID\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("之后进入flink目录提交任务到yarn：")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("./bin/flink run-application "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-t yarn-application "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-Dyarn.application.name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("TopSpeed "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-Dmetrics.reporter.promgateway.groupingKey"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"TopSpeed"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-Dmetrics.reporter.promgateway.jobName"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("TopSpeed "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-Denv.java.opts"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-DflinkJobName=TopSpeed"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n./examples/streaming/TopSpeedWindowing.jar\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("消费kafka的消息可以看到如下：")]),a._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"instant"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"epochSecond"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1655379271")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"nanoOfSecond"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("642000000")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"thread"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"main"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"level"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"INFO"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"loggerName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"org.apache.flink.runtime.io.network.netty.NettyServer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"message"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("\"Transport type 'auto': using EPOLL.\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"endOfBatch"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"loggerFqcn"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"org.apache.logging.slf4j.Log4jLogger"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"threadId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"threadPriority"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"logdir"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/yarn/container-logs/application_1655373794581_0005/container_e46_1655373794581_0005_01_000002/taskmanager.log"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"flinkJobName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"TopSpeed"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"yarnContainerId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"container_e46_1655373794581_0005_01_000002"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br")])]),s("h5",{attrs:{id:"_2-2-2-flink-standalone集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-flink-standalone集群"}},[a._v("#")]),a._v(" 2.2.2 Flink Standalone集群")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 根据kafka的版本放入kafka-clients")]),a._v("\nkafka-clients-3.1.0.jar\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# jackson对应的jar包")]),a._v("\njackson-annotations-2.13.3.jar\njackson-core-2.13.3.jar\njackson-databind-2.13.3.jar\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h3",{attrs:{id:"_3-flink日志接入elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-flink日志接入elasticsearch"}},[a._v("#")]),a._v(" 3. Flink日志接入Elasticsearch")]),a._v(" "),s("p",[a._v("日志写入Kafka之后可以通过Logstash接入elasticsearch，然后通过kibana进行查询或搜索，安装logstash的步骤可以参考官网。")]),a._v(" "),s("h4",{attrs:{id:"_3-1-配置logstash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-配置logstash"}},[a._v("#")]),a._v(" 3.1 配置Logstash")]),a._v(" "),s("p",[a._v("将以下内容写入"),s("code",[a._v("config/logstash-sample.conf")]),a._v("文件中")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('input {\n  kafka {\n    bootstrap_servers => ["cdh2:9092,cdh3:9092,cdh4:9092"]\n    group_id => "logstash-group"\n    topics => ["flink_logs"]\n    consumer_threads => 3\n    type => "flink-logs"\n    codec => "json"\n    auto_offset_reset => "latest"\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts => ["cdh2:9200","cdh3:9200","cdh4:9200"]\n    index => "flink-log-%{+YYYY-MM-dd}"\n  }\n}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br")])]),s("p",[a._v("上述配置按天生成新的flink日志索引，之后运行logstash，运行的日志没有报错即可在elasticsearch查看对应的索引日志。")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("bin/logstash -f ./config/logstash-sample.conf "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("./logs/logstash.log "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_3-2-利用kibana搜索日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-利用kibana搜索日志"}},[a._v("#")]),a._v(" 3.2 利用kibana搜索日志")]),a._v(" "),s("h5",{attrs:{id:"_3-2-1-创建索引模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-创建索引模式"}},[a._v("#")]),a._v(" 3.2.1 创建索引模式")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://yanko.test.upcdn.net/images/kibana-index-pattern.jpg",alt:""}})]),a._v(" "),s("p",[a._v("新建索引模式，因为我们上面的flink日志的索引名称为"),s("code",[a._v("flin-log-%{+YYYY-MM-dd}")]),a._v("，所以我们创建一个匹配flink-log的索引模式即可。")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://yanko.test.upcdn.net/images/kibana-index-pattern-create.jpg",alt:""}})]),a._v(" "),s("p",[a._v("之后点击下一步，选择时间字段为"),s("code",[a._v("@timestamp")]),a._v("即可。")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://yanko.test.upcdn.net/images/kibana-index-pattern-time.jpg",alt:""}})]),a._v(" "),s("h5",{attrs:{id:"_3-2-2-通过discover搜索日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-通过discover搜索日志"}},[a._v("#")]),a._v(" 3.2.2 通过Discover搜索日志")]),a._v(" "),s("p",[a._v("打开Discover选择刚刚创建的索引模式，在左上角可以添加筛选条件。")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://yanko.test.upcdn.net/images/kibana-log-discover.jpg",alt:""}})])])}),[],!1,null,null,null);t.default=n.exports}}]);
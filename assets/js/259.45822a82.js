(window.webpackJsonp=window.webpackJsonp||[]).push([[259],{761:function(s,a,t){"use strict";t.r(a);var e=t(21),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h4",{attrs:{id:"_1-spark的运行环境-local"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-spark的运行环境-local"}},[s._v("#")]),s._v(" 1. Spark的运行环境_Local")]),s._v(" "),t("p",[s._v("Spark作为一个数据处理框架和计算引擎，被设计在所有常见的集群环境中运行，在国内工作中主流的环境为Yarn。")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/Spark%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83.jpg",alt:""}})]),s._v(" "),t("p",[s._v("所谓的Local模式，就是不需要其他任何节点资源就可以在本地执行Spark代码的环境，一般用于教学、调试、演示等。")]),s._v(" "),t("h5",{attrs:{id:"_1-启动local环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-启动local环境"}},[s._v("#")]),s._v(" 1. 启动Local环境")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("进入解压缩后的路径，执行如下命令")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("bin/spark-shell\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/local.jpg",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("启动成功后，可以输入网址进行Web UI监控页面访问")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("http://虚拟机地址:4040\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/Spark-Web-UI.jpg",alt:""}})])])]),s._v(" "),t("h5",{attrs:{id:"_2-命令行工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-命令行工具"}},[s._v("#")]),s._v(" 2. 命令行工具")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("在解压缩的目录下的data目录下，添加words.txt文件。在命令行工具中执行如下代码")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('sc.textFile("data/words.txt").flatMap(_.split(" ")).map((_,1)).reduceByKey(_+_).collect\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/wordcount.jpg",alt:""}})])])]),s._v(" "),t("h5",{attrs:{id:"_3-退出本地模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-退出本地模式"}},[s._v("#")]),s._v(" 3. 退出本地模式")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v(":quit\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"_4-提交应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-提交应用"}},[s._v("#")]),s._v(" 4. 提交应用")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master local[2] \\ \n./examples/jars/spark-examples_2.11-2.4.6.jar \\\n10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("--class 表示要执行程序的主类")]),s._v(" "),t("li",[s._v("--master local[2] 部署模式，默认为本地模式，数字表示分配的虚拟CPU核数量")]),s._v(" "),t("li",[s._v("spark-examples_2.11-2.4.6.jar 运行的应用类所在的jar包")]),s._v(" "),t("li",[s._v("数字10表示程序的入口参数，用于设定当前应用的任务数量")])]),s._v(" "),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/spark-shell-pi.jpg",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_2-spark的运行环境-standalone"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-spark的运行环境-standalone"}},[s._v("#")]),s._v(" 2. Spark的运行环境_Standalone")]),s._v(" "),t("p",[s._v("只使用Spark自身节点运行的集群模式，也就是我们所谓的独立部署（Standalone）模式。Spark的Standalone模式体现了经典的master-slave模式。")]),s._v(" "),t("h5",{attrs:{id:"_1-解压缩文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-解压缩文件"}},[s._v("#")]),s._v(" 1. 解压缩文件")]),s._v(" "),t("p",[s._v("将spark-2.4.6文件上传到CetnOS并解压在指定位置")]),s._v(" "),t("h5",{attrs:{id:"_2-修改配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改配置文件"}},[s._v("#")]),s._v(" 2. 修改配置文件")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("进入解压缩后的路径的conf目录，修改slaves.template文件名为slaves")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mv slaves.template slaves\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("修改salves文件，添加work节点")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("master\nslave1\nslave2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("修改spark-env.sh.template文件名为spark-env.sh")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mv spark-env.sh.template spark-env.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("修改spark-env.sh文件，添加以下内容")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/apps/jdk1.8.0_162\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SCALA_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/apps/scala-2.11.12\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_MASTER_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("master\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_MASTER_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7077")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_WORKER_MEMORY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1024MB\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HADOOP_CONF_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/apps/hadoop-2.7.7/etc/hadoop\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_MASTER_WEBUI_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("将spark分发到集群的每台机器中")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("scp spark-2.4.6 slave1:/opt/apps\nscp spark-2.4.6 slave2:/opt/apps\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])]),s._v(" "),t("h5",{attrs:{id:"_3-启动集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动集群"}},[s._v("#")]),s._v(" 3. 启动集群")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("指定脚本命令")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sbin/start-all.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/start-all.jpg",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("查看Master资源监控Web UI界面")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/master.jpg",alt:""}})])])]),s._v(" "),t("h5",{attrs:{id:"_4-提交应用-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-提交应用-2"}},[s._v("#")]),s._v(" 4. 提交应用")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master spark://master:7077 \\\n./examples/jars/spark-examples_2.11-2.4.6.jar \\\n10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("--class 表示要执行程序的主类")]),s._v(" "),t("li",[s._v("--master spark://master:7077 独立部署模式，连接到Spark集群")]),s._v(" "),t("li",[s._v("spark-examples_2.11-2.4.6.jar 运行类所在的jar包")]),s._v(" "),t("li",[s._v("数字10表示程序的入口参数，用于设定当前应用的任务数量")])]),s._v(" "),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/standalone%E6%8F%90%E4%BA%A4%E4%BD%9C%E4%B8%9A.jpg",alt:""}})]),s._v(" "),t("p",[s._v("执行任务时，会产生多个Java进程")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/spark%E6%8F%90%E4%BA%A4%E4%BB%BB%E5%8A%A1.jpg",alt:""}})]),s._v(" "),t("p",[s._v("执行任务时，默认采用服务器集群节点的总核数，每个节点内存1024MB")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/spark%E6%8F%90%E4%BA%A4%E4%BD%9C%E4%B8%9A.jpg",alt:"spark提交作业"}})]),s._v(" "),t("h5",{attrs:{id:"_5-提交参数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-提交参数说明"}},[s._v("#")]),s._v(" 5. 提交参数说明")]),s._v(" "),t("p",[s._v("在提交应用中，一般会同时提交一些参数：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("参数")]),s._v(" "),t("th",[s._v("解释")]),s._v(" "),t("th",[s._v("可选值举例")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("--class")]),s._v(" "),t("td",[s._v("Spark程序中包含主函数的类")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("--master")]),s._v(" "),t("td",[s._v("Spark程序运行的模式（环境）")]),s._v(" "),t("td",[s._v("模式：local[*]、spark://master:7077、Yarn")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("--executor-memory 1G")]),s._v(" "),t("td",[s._v("指定每个executor可用内存为1G")]),s._v(" "),t("td",[s._v("符合集群内存配置即可，具体情况具体分析")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("--total-executor-cores 2")]),s._v(" "),t("td",[s._v("指定所有executor使用的cpu核数为2个")]),s._v(" "),t("td",[s._v("符合集群内存配置即可，具体情况具体分析")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("--executor-cores")]),s._v(" "),t("td",[s._v("指定每个executor使用的cpu核数")]),s._v(" "),t("td",[s._v("符合集群内存配置即可，具体情况具体分析")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("application-jar")]),s._v(" "),t("td",[s._v("打包好的应用jar，包含依赖。这个URL在集群中全局可见。比如hdfs://共享存储系统，如果是file://path，南所有的节点path都要包含同样的jar")]),s._v(" "),t("td",[s._v("符合集群内存配置即可，具体情况具体分析")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("application-arguments")]),s._v(" "),t("td",[s._v("传给main()方法的参数")]),s._v(" "),t("td",[s._v("符合集群内存配置即可，具体情况具体分析")])])])]),s._v(" "),t("h5",{attrs:{id:"_6-配置历史服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-配置历史服务"}},[s._v("#")]),s._v(" 6. 配置历史服务")]),s._v(" "),t("p",[s._v("由于spark-shell停止掉后，集群监控"),t("code",[s._v("master:4040")]),s._v("页面就看不到历史任务的运行情况，所以开发时都配置历史服务器记录任务运行情况。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("修改spark-defaults.conf.template文件名为spark-defaults.conf")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mv spark-defaults.conf.template spark-defaults.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("修改spark-defalult.conf文件，配置日志存储路径")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("spark.eventLog.enabled\ttrue\nspark.eventLog.dir\t\thdfs://master:8020/history\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("注意：需要启动hadoop集群，HDFS上的directory目录需要提前存在")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sbin/start-dfs.sh\nhadoop fs -mkdir /history\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("修改spark-env.sh文件，添加日志配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('export SPARK_HISTORY_OPTS="-Dspark.history.ui.port=18080 -Dspark.history.fs.logDirectory=hdfs://master:8020/history -Dspark.history.retainedApplication=30"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("参数1含义：WEB UI访问的端口号18080")]),s._v(" "),t("li",[s._v("参数2含义：指定历史服务器日志存储路径")]),s._v(" "),t("li",[s._v("参数3含义：指定保存Application历史记录的个数，如果超过这个值，旧的应用程序信息将被删除，这个是内存中的应用数，而不是页面上显示的应用数。")])])]),s._v(" "),t("li",[t("p",[s._v("分发配置文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("scp conf slave1:/opt/apps/spark-2.4.6/\nscp conf slave2:/opt/apps/spark-2.4.6/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("重新启动集群和历史服务")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sbin/start-all.sh\nsbin/start-history-server.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("重新执行任务")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/standalone%E6%8F%90%E4%BA%A4%E4%BD%9C%E4%B8%9A.jpg",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("查看历史服务：http://master:18080")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/history-server.jpg",alt:""}})])])]),s._v(" "),t("h5",{attrs:{id:"_7-配置高可用-ha"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-配置高可用-ha"}},[s._v("#")]),s._v(" 7. 配置高可用（HA）")]),s._v(" "),t("p",[s._v("所谓的高可用是因为当前集群中的Master节点只有一个，所以会存在单点故障问题。所以为了解决单点故障问题，需要在集群中配置多个Master节点，一旦处于活动状态的Master发生故障时，由备用Master提供服务，保证作业可以继续执行。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("停止集群启动Zookeeper")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sbin/stop-all.sh\nzkServer.sh start\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("修改spark-env.sh文件添加如下配置")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注释如下内容：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SPARK_MASTER_HOST=master")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SPARK_MASTER_PORT=7077")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加如下内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_MASTER_WEBUI_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_DAEMON_JAVA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Dspark.deploy.recoveryMode=ZOOKEEPER -Dspark.deploy.zookeeper.url=master,slave1,slave2 -Dspark.deploy.zookeeper.dir=/spark"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("分发配置文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("scp conf slave1:/opt/apps/spark-2.4.6/\nscp conf slave2:/opt/apps/spark-2.4.6/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("启动集群")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sbin/start-all.sh\n\n- 启动备用节点\nsbin/start-master.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("master上的Master节点")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/master.jpg",alt:""}})]),s._v(" "),t("p",[s._v("slave1上的备用Master节点")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/slave1.jpg",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("提交应用到高可用集群")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master spark://master:7077,slave1:7077 \\\n./examples/jars/spark-examples_2.11-2.4.6.jar \\\n10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])]),s._v(" "),t("h4",{attrs:{id:"_3-spark的运行环境-yarn"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-spark的运行环境-yarn"}},[s._v("#")]),s._v(" 3. Spark的运行环境_Yarn")]),s._v(" "),t("p",[s._v("独立部署（Standalone）模式由Spark自身提供计算资源，无需其它框架提供资源。这种方式降低了和其它第三方资源框架的耦合性，独立性非常强。但是由于Spark本身是计算框架，所以本身提供的资源调度并不是它的强项。")]),s._v(" "),t("h5",{attrs:{id:"_1-解压缩文件-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-解压缩文件-2"}},[s._v("#")]),s._v(" 1. 解压缩文件")]),s._v(" "),t("p",[s._v("将spark-2.4.6.tgz文件上传到CentOS并解压缩，放置在指定位置。")]),s._v(" "),t("h5",{attrs:{id:"_2-修改配置文件-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改配置文件-2"}},[s._v("#")]),s._v(" 2. 修改配置文件")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("修改hadoop配置文件/opt/app/hadoop-2.7.7/etc/hadoop/yarn-site.xml，并分发")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 是否启动一个线程检查每个任务正使用的物理内存量，如果任务超出分配值，则直接将其杀掉，默认是true --\x3e")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("yarn.nodemanager.pmem-check-enabled"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("false"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 是否启动一个线程检查每个任务正使用的虚拟内存量，如果任务超出分配值，则直接将其杀掉，默认是true --\x3e")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("yarn.nodemanager.vmem-check-enabled"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("false"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("修改conf/spark-env.sh，添加JAVA_HOME和YARN_CONF_DIR配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("export JAVA_HOME=/opt/apps/jdk1.8.0_162\nYARN_CONF_DIR=/opt/apps/hadoop-2.7.7/etc/hadoop\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])]),s._v(" "),t("h5",{attrs:{id:"_3-启动hdfs以及yarn集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动hdfs以及yarn集群"}},[s._v("#")]),s._v(" 3. 启动HDFS以及YARN集群")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sbin/start-dfs.sh\nsbin/start-yarn.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h5",{attrs:{id:"_4-提交应用-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-提交应用-3"}},[s._v("#")]),s._v(" 4. 提交应用")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master yarn \\\n--deploy-mode cluster \\\n./examples/jars/spark-examples_2.11-2.4.6.jar \\\n10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/yarn-submit.jpg",alt:""}})]),s._v(" "),t("p",[s._v("查看http://master:8088页面，点击History，查看历史页面")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/yarn-history.jpg",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"_5-配置历史服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置历史服务器"}},[s._v("#")]),s._v(" 5. 配置历史服务器")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("修改spark-defaults.conf.template文件名为spark-defaults.conf")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mv spark-defaults.conf.template spark-defaults.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("修改spark-defalult.conf文件，配置日志存储路径")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("spark.eventLog.enabled\ttrue\nspark.eventLog.dir\t\thdfs://master:8020/history\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("注意：需要启动hadoop集群，HDFS上的directory目录需要提前存在")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sbin/start-dfs.sh\nhadoop fs -mkdir /history\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("修改spark-env.sh文件，添加日志配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('export SPARK_HISTORY_OPTS="-Dspark.history.ui.port=18080 -Dspark.history.fs.logDirectory=hdfs://master:8020/history -Dspark.history.retainedApplication=30"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("参数1含义：WEB UI访问的端口号18080")]),s._v(" "),t("li",[s._v("参数2含义：指定历史服务器日志存储路径")]),s._v(" "),t("li",[s._v("参数3含义：指定保存Application历史记录的个数，如果超过这个值，旧的应用程序信息将被删除，这个是内存中的应用数，而不是页面上显示的应用数。")])])]),s._v(" "),t("li",[t("p",[s._v("修改spark-defaults.conf")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("spark.yarn.historyServer.address=master:18080\nspark.history.ui.port=18080\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("分发配置文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("scp conf slave1:/opt/apps/spark-2.4.6/\nscp conf slave2:/opt/apps/spark-2.4.6/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("重新启动集群和历史服务")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sbin/start-all.sh\nsbin/start-history-server.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("重新执行任务")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master yarn \\\n--deploy-mode client \\\n./examples/jars/spark-examples_2.11-2.4.6.jar \\\n10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/yarn-client.jpg",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("查看历史服务：http://master:18080")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://typora-image.test.upcdn.net/images/yarn-history-spark.jpg",alt:""}})])])]),s._v(" "),t("h5",{attrs:{id:"_6-yarn-client和yarn-cluster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-yarn-client和yarn-cluster"}},[s._v("#")]),s._v(" 6. Yarn Client和Yarn Cluster")]),s._v(" "),t("p",[s._v("这两种模式本质的区别在于AM（Application Master）进程的区别。")]),s._v(" "),t("ul",[t("li",[s._v("Cluster：Cluster模式下，Spark Driver运行在AM中，负责向Yarn(RM)申请资源，并监督Application的运行情况。当Client提交作业后，就会关闭Client，作业会继续在Yarn上运行，这也是Cluster模式不适合交互类型作业的原因。")]),s._v(" "),t("li",[s._v("Client：AM不仅仅向Yarn(RM)申请资源，之后Client会和请求的Container通信来完成任务的调度，即Client不能被关闭。")])]),s._v(" "),t("p",[s._v("一般情况下，先在Client模式下调通任务，之后提交到Cluster上进行运行。")])])}),[],!1,null,null,null);a.default=r.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[248],{750:function(s,t,a){"use strict";a.r(t);var e=a(21),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("文末附下载方式")])]),s._v(" "),a("h3",{attrs:{id:"_1-下载对应的安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载对应的安装"}},[s._v("#")]),s._v(" 1. 下载对应的安装")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[s._v("组件")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("版本")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("下载地址")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("Prometheus")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("2.36.1")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("a",{attrs:{href:"https://github.com/prometheus/prometheus/releases/download/v2.36.1/prometheus-2.36.1.linux-amd64.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),a("OutboundLink")],1)])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("Pusgateway")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("1.4.3")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("a",{attrs:{href:"https://github.com/prometheus/pushgateway/releases/download/v1.4.3/pushgateway-1.4.3.linux-amd64.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),a("OutboundLink")],1)])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("node_exporter")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("1.3.1")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("a",{attrs:{href:"https://github.com/prometheus/node_exporter/releases/download/v1.3.1/node_exporter-1.3.1.linux-amd64.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),a("OutboundLink")],1)])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("Grafana")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("8.5.6")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("a",{attrs:{href:"https://dl.grafana.com/enterprise/release/grafana-enterprise-8.5.6-1.x86_64.rpm",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),a("OutboundLink")],1)])])])]),s._v(" "),a("h3",{attrs:{id:"_2-安装并运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装并运行"}},[s._v("#")]),s._v(" 2. 安装并运行")]),s._v(" "),a("h4",{attrs:{id:"_2-1-安装pushgateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装pushgateway"}},[s._v("#")]),s._v(" 2.1 安装pushgateway")]),s._v(" "),a("p",[s._v("将pushgateway解压到指定目录后，直接运行pushgateway即可")]),s._v(" "),a("p",[s._v("启动pushgateway")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./pushgateway --web.listen-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('":9092"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./pushgateway-start.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("将push gateway安装为系统服务，让"),a("code",[s._v("systemctl")]),s._v("来管理，直接修改"),a("code",[s._v("/usr/lib/systemd/system/pushgateway.service")]),s._v("，写入以下内容：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[Unit]\nDescription=pushgateway\nAfter=local-fs.target network-online.target network.target\nWants=local-fs.target network-online.target network.target\n\n[Service]\nExecStart=/opt/modules/pushgateway/pushgateway --web.listen-address=:9092\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("设置开机自启")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" pushgateway\nsystemctl start pushgateway\nsystemctl status pushgateway\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"_2-2-安装node-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-安装node-exporter"}},[s._v("#")]),s._v(" 2.2 安装node_exporter")]),s._v(" "),a("p",[s._v("将node_exporter解压到指定目录后，直接运行node_exporter即可")]),s._v(" "),a("p",[s._v("启动node_exporter")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./node_exporter --web.listen-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('":9100"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./node_exporter-start.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("将node_exporter安装为系统服务，让"),a("code",[s._v("systemctl")]),s._v("来管理，直接修改"),a("code",[s._v("/usr/lib/systemd/system/node_exporter.service")]),s._v("，写入以下内容：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[Unit]\nDescription=node_exporter\nAfter=local-fs.target network-online.target network.target\nWants=local-fs.target network-online.target network.target\n\n[Service]\nExecStart=/opt/modules/node_exporter/node_exporter --web.listen-address=:9100\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("设置开机自启")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" node_exporter\nsystemctl start node_exporter\nsystemctl status node_exporter\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"_2-3-安装prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-安装prometheus"}},[s._v("#")]),s._v(" 2.3 安装Prometheus")]),s._v(" "),a("p",[s._v("解压Prometheus到安装目录，并修改目录下的"),a("code",[s._v("prometheus.yml")]),s._v("配置文件：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# my global config")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set the scrape interval to every 15 seconds. Default is every 1 minute.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("evaluation_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Evaluate rules every 15 seconds. The default is every 1 minute.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scrape_timeout is set to the global default (10s).")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Alertmanager configuration")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alerting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alertmanagers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - alertmanager:9093")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule_files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "first_rules.yml"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "second_rules.yml"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prometheus"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认端口是9090")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cdh1:9093"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instances")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pushgateway"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认为1分钟")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认端口是9091")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cdh1:9092"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instances")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pushgateway\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_exporter"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cdh1:9100"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instances")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node_exporter\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br")])]),a("p",[s._v("启动Prometheus服务")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./prometheus --config.file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("./prometheus.yml --web.listen-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('":9093"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./prometheus-start.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("启动之后在web页面上可以看到pushgateway、node_exporter以及prometheus的运行情况，地址"),a("code",[s._v("ip:port/targets")])]),s._v(" "),a("p",[a("img",{attrs:{src:"http://yanko.test.upcdn.net/images/prometheus-targets.jpg",alt:""}})]),s._v(" "),a("p",[s._v("将prometheus安装为系统服务，让"),a("code",[s._v("systemctl")]),s._v("来管理，直接修改"),a("code",[s._v("/usr/lib/systemd/system/prometheus.service")]),s._v("，写入以下内容：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[Unit]\nDescription=prometheus\nAfter=local-fs.target network-online.target network.target\nWants=local-fs.target network-online.target network.target\n\n[Service]\nExecStart=/opt/modules/prometheus/prometheus --config.file=/opt/modules/prometheus/prometheus.yml --web.listen-address=:9093\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("设置开机自启")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" prometheus\nsystemctl start prometheus\nsystemctl status prometheus\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"_2-4-安装grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-安装grafana"}},[s._v("#")]),s._v(" 2.4 安装Grafana")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://dl.grafana.com/enterprise/release/grafana-enterprise-9.0.0-1.x86_64.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" grafana-enterprise-9.0.0-1.x86_64.rpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("启动Grafana服务")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start grafana-server\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("启动Grafana后，可以访问web页面，地址是"),a("code",[s._v("ip:3000")]),s._v("，默认用户名和密码是"),a("code",[s._v("admin/admin")]),s._v("。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://yanko.test.upcdn.net/images/grafana-login.jpg",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_3-配置grafana数据源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置grafana数据源"}},[s._v("#")]),s._v(" 3. 配置Grafana数据源")]),s._v(" "),a("p",[s._v("进入"),a("code",[s._v("Setting")]),s._v("中选择"),a("code",[s._v("Add Data source")]),s._v("即可添加数据源，选择prometheus即可，添加完成后保存测试。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://yanko.test.upcdn.net/images/grafana-prometheus.jpg",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_4-配置flink上报metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置flink上报metrics"}},[s._v("#")]),s._v(" 4. 配置Flink上报Metrics")]),s._v(" "),a("p",[s._v("修改"),a("code",[s._v("flink-conf.yaml")]),s._v("配置文件，新增如下配置：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics.reporter.promgateway.class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" org.apache.flink.metrics.prometheus.PrometheusPushGatewayReporter\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pushgateway的地址和端口号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics.reporter.promgateway.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cdh1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics.reporter.promgateway.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9092")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics.reporter.promgateway.jobName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" FlinkJob\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否自动生成JobName")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics.reporter.promgateway.randomJobNameSuffix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 作业结束后删除其对应的Metrics")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics.reporter.promgateway.deleteOnShutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics.reporter.promgateway.groupingKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" k1=v1;k2=v2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上报Metrics的频率")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics.reporter.promgateway.interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10 SECONDS\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("配置好之后运行flink的测试案例：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("bin/flink run -d -t yarn-per-job ./examples/streaming/TopSpeedWindowing.jar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("再次访问pushgateway的页面可以看到如下的metrics上报信息")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://yanko.test.upcdn.net/images/pushgateway-metrics.jpg",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_5-登陆grafana配置flink监控面板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-登陆grafana配置flink监控面板"}},[s._v("#")]),s._v(" 5. 登陆Grafana配置Flink监控面板")]),s._v(" "),a("p",[s._v("访问Grafana的dashboards页面，下载Flink的dashboards模板，官网下载地址"),a("code",[s._v("https://grafana.com/grafana/dashboards/")])]),s._v(" "),a("p",[s._v("下载好之后打开Grafana Web UI通过import导入刚刚所下载的Flink Metrics监控模板")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://yanko.test.upcdn.net/images/grafana-flink.jpg",alt:""}})]),s._v(" "),a("p",[s._v("之后打开该dashboards即可看到flink的metrics信息")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://yanko.test.upcdn.net/images/grafana-flink-metrics.jpg",alt:""}})])])}),[],!1,null,null,null);t.default=n.exports}}]);
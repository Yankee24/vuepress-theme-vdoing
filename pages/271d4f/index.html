<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《从0学习Flink源码》——Flink集群启动流程 | 从零学习大数据</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="web前端技术博客,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.e5addeae.css" as="style"><link rel="preload" href="/assets/js/app.69860091.js" as="script"><link rel="preload" href="/assets/js/2.5a5d1011.js" as="script"><link rel="preload" href="/assets/js/251.221ffd29.js" as="script"><link rel="prefetch" href="/assets/js/10.923ff8fe.js"><link rel="prefetch" href="/assets/js/100.f16aede8.js"><link rel="prefetch" href="/assets/js/101.16b3943d.js"><link rel="prefetch" href="/assets/js/102.1b982033.js"><link rel="prefetch" href="/assets/js/103.0edcb49a.js"><link rel="prefetch" href="/assets/js/104.93fd3934.js"><link rel="prefetch" href="/assets/js/105.7b351476.js"><link rel="prefetch" href="/assets/js/106.05c3afe2.js"><link rel="prefetch" href="/assets/js/107.17f5d621.js"><link rel="prefetch" href="/assets/js/108.6b0b469a.js"><link rel="prefetch" href="/assets/js/109.5fe5c7fd.js"><link rel="prefetch" href="/assets/js/11.5a5e6faf.js"><link rel="prefetch" href="/assets/js/110.8c2e1ad0.js"><link rel="prefetch" href="/assets/js/111.e7f443a4.js"><link rel="prefetch" href="/assets/js/112.3cc06ecb.js"><link rel="prefetch" href="/assets/js/113.0fd65e42.js"><link rel="prefetch" href="/assets/js/114.f40f9e82.js"><link rel="prefetch" href="/assets/js/115.db5479c4.js"><link rel="prefetch" href="/assets/js/116.584588db.js"><link rel="prefetch" href="/assets/js/117.0389dc01.js"><link rel="prefetch" href="/assets/js/118.20eb6ebf.js"><link rel="prefetch" href="/assets/js/119.aaaa830d.js"><link rel="prefetch" href="/assets/js/12.5bcae2a5.js"><link rel="prefetch" href="/assets/js/120.96fe3cc8.js"><link rel="prefetch" href="/assets/js/121.c12e5733.js"><link rel="prefetch" href="/assets/js/122.0b114237.js"><link rel="prefetch" href="/assets/js/123.85896876.js"><link rel="prefetch" href="/assets/js/124.d4ce4448.js"><link rel="prefetch" href="/assets/js/125.a07e629d.js"><link rel="prefetch" href="/assets/js/126.e82bc271.js"><link rel="prefetch" href="/assets/js/127.b966dc51.js"><link rel="prefetch" href="/assets/js/128.f5318311.js"><link rel="prefetch" href="/assets/js/129.033da70b.js"><link rel="prefetch" href="/assets/js/13.b0e48d3c.js"><link rel="prefetch" href="/assets/js/130.6e51a8a3.js"><link rel="prefetch" href="/assets/js/131.a9eac853.js"><link rel="prefetch" href="/assets/js/132.51cc0fe9.js"><link rel="prefetch" href="/assets/js/133.7c4e5fa5.js"><link rel="prefetch" href="/assets/js/134.0d4649d4.js"><link rel="prefetch" href="/assets/js/135.2795b689.js"><link rel="prefetch" href="/assets/js/136.6d810189.js"><link rel="prefetch" href="/assets/js/137.5efba685.js"><link rel="prefetch" href="/assets/js/138.e6ffeb9b.js"><link rel="prefetch" href="/assets/js/139.0f6209a7.js"><link rel="prefetch" href="/assets/js/14.aa487061.js"><link rel="prefetch" href="/assets/js/140.d608dfc1.js"><link rel="prefetch" href="/assets/js/141.260a5e10.js"><link rel="prefetch" href="/assets/js/142.a1bf6834.js"><link rel="prefetch" href="/assets/js/143.e8504b72.js"><link rel="prefetch" href="/assets/js/144.473e503a.js"><link rel="prefetch" href="/assets/js/145.05597eba.js"><link rel="prefetch" href="/assets/js/146.720763ca.js"><link rel="prefetch" href="/assets/js/147.4f8213bf.js"><link rel="prefetch" href="/assets/js/148.822505fd.js"><link rel="prefetch" href="/assets/js/149.0012118f.js"><link rel="prefetch" href="/assets/js/15.9daa4aeb.js"><link rel="prefetch" href="/assets/js/150.8fc18c42.js"><link rel="prefetch" href="/assets/js/151.5fafe6cd.js"><link rel="prefetch" href="/assets/js/152.30d29af5.js"><link rel="prefetch" href="/assets/js/153.24749e28.js"><link rel="prefetch" href="/assets/js/154.f6e6152a.js"><link rel="prefetch" href="/assets/js/155.d6998d0c.js"><link rel="prefetch" href="/assets/js/156.a0b198c0.js"><link rel="prefetch" href="/assets/js/157.a4168bf4.js"><link rel="prefetch" href="/assets/js/158.df0a8e57.js"><link rel="prefetch" href="/assets/js/159.9c922bc7.js"><link rel="prefetch" href="/assets/js/16.181cffa1.js"><link rel="prefetch" href="/assets/js/160.b0dfe382.js"><link rel="prefetch" href="/assets/js/161.74b287eb.js"><link rel="prefetch" href="/assets/js/162.e53e48f5.js"><link rel="prefetch" href="/assets/js/163.858bdc76.js"><link rel="prefetch" href="/assets/js/164.db9e00ed.js"><link rel="prefetch" href="/assets/js/165.7665ebd3.js"><link rel="prefetch" href="/assets/js/166.bdec7786.js"><link rel="prefetch" href="/assets/js/167.943c7fac.js"><link rel="prefetch" href="/assets/js/168.82b92810.js"><link rel="prefetch" href="/assets/js/169.79bbcbe7.js"><link rel="prefetch" href="/assets/js/17.aed045e3.js"><link rel="prefetch" href="/assets/js/170.3c6a8856.js"><link rel="prefetch" href="/assets/js/171.7b446bf8.js"><link rel="prefetch" href="/assets/js/172.9b4f968c.js"><link rel="prefetch" href="/assets/js/173.fbc1675b.js"><link rel="prefetch" href="/assets/js/174.73be5b8d.js"><link rel="prefetch" href="/assets/js/175.249c730a.js"><link rel="prefetch" href="/assets/js/176.bdcc8567.js"><link rel="prefetch" href="/assets/js/177.670af4ec.js"><link rel="prefetch" href="/assets/js/178.8f4a08d1.js"><link rel="prefetch" href="/assets/js/179.79ede7b6.js"><link rel="prefetch" href="/assets/js/18.5d983a22.js"><link rel="prefetch" href="/assets/js/180.bf9b14b2.js"><link rel="prefetch" href="/assets/js/181.af12bc7e.js"><link rel="prefetch" href="/assets/js/182.c209db51.js"><link rel="prefetch" href="/assets/js/183.b4865945.js"><link rel="prefetch" href="/assets/js/184.7e08d8a2.js"><link rel="prefetch" href="/assets/js/185.89540961.js"><link rel="prefetch" href="/assets/js/186.bf93d0cf.js"><link rel="prefetch" href="/assets/js/187.c7ab2562.js"><link rel="prefetch" href="/assets/js/188.65098466.js"><link rel="prefetch" href="/assets/js/189.6435b2ab.js"><link rel="prefetch" href="/assets/js/19.1f9fbdc9.js"><link rel="prefetch" href="/assets/js/190.7b09958a.js"><link rel="prefetch" href="/assets/js/191.2cf71180.js"><link rel="prefetch" href="/assets/js/192.8d9704a7.js"><link rel="prefetch" href="/assets/js/193.bf6325b9.js"><link rel="prefetch" href="/assets/js/194.4f0fafd1.js"><link rel="prefetch" href="/assets/js/195.246863ac.js"><link rel="prefetch" href="/assets/js/196.f608f32b.js"><link rel="prefetch" href="/assets/js/197.f6cc8f50.js"><link rel="prefetch" href="/assets/js/198.a5578d26.js"><link rel="prefetch" href="/assets/js/199.11890423.js"><link rel="prefetch" href="/assets/js/20.4cb88e4b.js"><link rel="prefetch" href="/assets/js/200.c9f8e946.js"><link rel="prefetch" href="/assets/js/201.ce037fc7.js"><link rel="prefetch" href="/assets/js/202.ef0539ce.js"><link rel="prefetch" href="/assets/js/203.988c68d9.js"><link rel="prefetch" href="/assets/js/204.6c137aab.js"><link rel="prefetch" href="/assets/js/205.9036bb65.js"><link rel="prefetch" href="/assets/js/206.c580525c.js"><link rel="prefetch" href="/assets/js/207.7c41326a.js"><link rel="prefetch" href="/assets/js/208.1607d918.js"><link rel="prefetch" href="/assets/js/209.9259989c.js"><link rel="prefetch" href="/assets/js/21.80ec6f40.js"><link rel="prefetch" href="/assets/js/210.d50db2ef.js"><link rel="prefetch" href="/assets/js/211.bc2685b0.js"><link rel="prefetch" href="/assets/js/212.efea3cf2.js"><link rel="prefetch" href="/assets/js/213.bce9f926.js"><link rel="prefetch" href="/assets/js/214.904b4497.js"><link rel="prefetch" href="/assets/js/215.6aefea59.js"><link rel="prefetch" href="/assets/js/216.e031d3bd.js"><link rel="prefetch" href="/assets/js/217.e6326d37.js"><link rel="prefetch" href="/assets/js/218.9aed6d93.js"><link rel="prefetch" href="/assets/js/219.9e16adc0.js"><link rel="prefetch" href="/assets/js/22.05fa6204.js"><link rel="prefetch" href="/assets/js/220.b214d6d8.js"><link rel="prefetch" href="/assets/js/221.bc937a8c.js"><link rel="prefetch" href="/assets/js/222.a113a4fb.js"><link rel="prefetch" href="/assets/js/223.385290e7.js"><link rel="prefetch" href="/assets/js/224.8130ac54.js"><link rel="prefetch" href="/assets/js/225.f39ff910.js"><link rel="prefetch" href="/assets/js/226.099d1901.js"><link rel="prefetch" href="/assets/js/227.e1f6b467.js"><link rel="prefetch" href="/assets/js/228.d82f8db3.js"><link rel="prefetch" href="/assets/js/229.eda913c0.js"><link rel="prefetch" href="/assets/js/23.33289b0e.js"><link rel="prefetch" href="/assets/js/230.a4020d42.js"><link rel="prefetch" href="/assets/js/231.f37f1b59.js"><link rel="prefetch" href="/assets/js/232.6f2c9e2d.js"><link rel="prefetch" href="/assets/js/233.90b6ca00.js"><link rel="prefetch" href="/assets/js/234.aa025266.js"><link rel="prefetch" href="/assets/js/235.89829e8d.js"><link rel="prefetch" href="/assets/js/236.0de24334.js"><link rel="prefetch" href="/assets/js/237.ca10ac0d.js"><link rel="prefetch" href="/assets/js/238.bc0b2f20.js"><link rel="prefetch" href="/assets/js/239.b7361c91.js"><link rel="prefetch" href="/assets/js/24.222b2e5a.js"><link rel="prefetch" href="/assets/js/240.7fdb9c15.js"><link rel="prefetch" href="/assets/js/241.439455de.js"><link rel="prefetch" href="/assets/js/242.3a285408.js"><link rel="prefetch" href="/assets/js/243.9060c910.js"><link rel="prefetch" href="/assets/js/244.65c17482.js"><link rel="prefetch" href="/assets/js/245.655b77db.js"><link rel="prefetch" href="/assets/js/246.de53591d.js"><link rel="prefetch" href="/assets/js/247.a1411e89.js"><link rel="prefetch" href="/assets/js/248.f2b6d619.js"><link rel="prefetch" href="/assets/js/249.40cc2013.js"><link rel="prefetch" href="/assets/js/25.fd519c59.js"><link rel="prefetch" href="/assets/js/250.d18d274b.js"><link rel="prefetch" href="/assets/js/252.749deb12.js"><link rel="prefetch" href="/assets/js/253.cb462023.js"><link rel="prefetch" href="/assets/js/254.8b979b0e.js"><link rel="prefetch" href="/assets/js/255.c420fc14.js"><link rel="prefetch" href="/assets/js/256.cc875ff8.js"><link rel="prefetch" href="/assets/js/257.80c6d2c7.js"><link rel="prefetch" href="/assets/js/258.039d78aa.js"><link rel="prefetch" href="/assets/js/259.45822a82.js"><link rel="prefetch" href="/assets/js/26.c77d9f44.js"><link rel="prefetch" href="/assets/js/260.9606e8ea.js"><link rel="prefetch" href="/assets/js/261.5bb91bcb.js"><link rel="prefetch" href="/assets/js/262.c14ea476.js"><link rel="prefetch" href="/assets/js/263.4d300af5.js"><link rel="prefetch" href="/assets/js/264.4965d6cd.js"><link rel="prefetch" href="/assets/js/265.3ab3d8df.js"><link rel="prefetch" href="/assets/js/266.a356cba1.js"><link rel="prefetch" href="/assets/js/267.a8c17038.js"><link rel="prefetch" href="/assets/js/268.404d0f59.js"><link rel="prefetch" href="/assets/js/269.d6c5b967.js"><link rel="prefetch" href="/assets/js/27.2d4e462d.js"><link rel="prefetch" href="/assets/js/270.ee054be0.js"><link rel="prefetch" href="/assets/js/271.0d024575.js"><link rel="prefetch" href="/assets/js/272.0a220788.js"><link rel="prefetch" href="/assets/js/273.f0094be8.js"><link rel="prefetch" href="/assets/js/274.96185f67.js"><link rel="prefetch" href="/assets/js/275.01716e6c.js"><link rel="prefetch" href="/assets/js/276.52d955a8.js"><link rel="prefetch" href="/assets/js/277.16592fb3.js"><link rel="prefetch" href="/assets/js/278.f37681fd.js"><link rel="prefetch" href="/assets/js/28.2d9f6816.js"><link rel="prefetch" href="/assets/js/29.22ed0fbf.js"><link rel="prefetch" href="/assets/js/3.b5505cb0.js"><link rel="prefetch" href="/assets/js/30.ab67dc1f.js"><link rel="prefetch" href="/assets/js/31.2b540d9e.js"><link rel="prefetch" href="/assets/js/32.1522eb16.js"><link rel="prefetch" href="/assets/js/33.f65f5043.js"><link rel="prefetch" href="/assets/js/34.80cc3f17.js"><link rel="prefetch" href="/assets/js/35.fa8dfa7e.js"><link rel="prefetch" href="/assets/js/36.7120533b.js"><link rel="prefetch" href="/assets/js/37.c5a78bc9.js"><link rel="prefetch" href="/assets/js/38.69c7afa0.js"><link rel="prefetch" href="/assets/js/39.0eef158e.js"><link rel="prefetch" href="/assets/js/4.ff141686.js"><link rel="prefetch" href="/assets/js/40.35c52f34.js"><link rel="prefetch" href="/assets/js/41.26d8c534.js"><link rel="prefetch" href="/assets/js/42.8bc84b00.js"><link rel="prefetch" href="/assets/js/43.d8065eba.js"><link rel="prefetch" href="/assets/js/44.b19c19b0.js"><link rel="prefetch" href="/assets/js/45.8d5a2abd.js"><link rel="prefetch" href="/assets/js/46.47f5b7a1.js"><link rel="prefetch" href="/assets/js/47.10f3e4e0.js"><link rel="prefetch" href="/assets/js/48.987bbb14.js"><link rel="prefetch" href="/assets/js/49.294ccf05.js"><link rel="prefetch" href="/assets/js/5.804a9c7d.js"><link rel="prefetch" href="/assets/js/50.95d99a21.js"><link rel="prefetch" href="/assets/js/51.f9b2e205.js"><link rel="prefetch" href="/assets/js/52.0762648d.js"><link rel="prefetch" href="/assets/js/53.abd32869.js"><link rel="prefetch" href="/assets/js/54.7441c3bb.js"><link rel="prefetch" href="/assets/js/55.4cefc5c5.js"><link rel="prefetch" href="/assets/js/56.f0a167f5.js"><link rel="prefetch" href="/assets/js/57.e7c2b85d.js"><link rel="prefetch" href="/assets/js/58.6efa9d32.js"><link rel="prefetch" href="/assets/js/59.d3b84ddf.js"><link rel="prefetch" href="/assets/js/6.9beabe83.js"><link rel="prefetch" href="/assets/js/60.17f54d49.js"><link rel="prefetch" href="/assets/js/61.3ec7fc02.js"><link rel="prefetch" href="/assets/js/62.d37f1c0c.js"><link rel="prefetch" href="/assets/js/63.42881792.js"><link rel="prefetch" href="/assets/js/64.11a6d2dd.js"><link rel="prefetch" href="/assets/js/65.bf703c16.js"><link rel="prefetch" href="/assets/js/66.ed5395d3.js"><link rel="prefetch" href="/assets/js/67.c1063689.js"><link rel="prefetch" href="/assets/js/68.c8485750.js"><link rel="prefetch" href="/assets/js/69.615e51f0.js"><link rel="prefetch" href="/assets/js/7.fec36169.js"><link rel="prefetch" href="/assets/js/70.a9ce79fc.js"><link rel="prefetch" href="/assets/js/71.e06041f7.js"><link rel="prefetch" href="/assets/js/72.43904462.js"><link rel="prefetch" href="/assets/js/73.c758fa40.js"><link rel="prefetch" href="/assets/js/74.5cfa12f4.js"><link rel="prefetch" href="/assets/js/75.ae5a3df9.js"><link rel="prefetch" href="/assets/js/76.30f68e44.js"><link rel="prefetch" href="/assets/js/77.47917316.js"><link rel="prefetch" href="/assets/js/78.eb1a0f14.js"><link rel="prefetch" href="/assets/js/79.44f29445.js"><link rel="prefetch" href="/assets/js/8.8d4140a1.js"><link rel="prefetch" href="/assets/js/80.15297bfe.js"><link rel="prefetch" href="/assets/js/81.0f68e8af.js"><link rel="prefetch" href="/assets/js/82.14d5a78a.js"><link rel="prefetch" href="/assets/js/83.499cba09.js"><link rel="prefetch" href="/assets/js/84.adfbad7c.js"><link rel="prefetch" href="/assets/js/85.2a7dc9f1.js"><link rel="prefetch" href="/assets/js/86.181c6b1f.js"><link rel="prefetch" href="/assets/js/87.e1b5f8f8.js"><link rel="prefetch" href="/assets/js/88.e48ff88a.js"><link rel="prefetch" href="/assets/js/89.3c55b2a2.js"><link rel="prefetch" href="/assets/js/9.02e0b20e.js"><link rel="prefetch" href="/assets/js/90.eb838c7c.js"><link rel="prefetch" href="/assets/js/91.f9de218b.js"><link rel="prefetch" href="/assets/js/92.1b34a23f.js"><link rel="prefetch" href="/assets/js/93.380e957c.js"><link rel="prefetch" href="/assets/js/94.feb95e99.js"><link rel="prefetch" href="/assets/js/95.6e722f95.js"><link rel="prefetch" href="/assets/js/96.8e625826.js"><link rel="prefetch" href="/assets/js/97.ae5a2075.js"><link rel="prefetch" href="/assets/js/98.716f5b6e.js"><link rel="prefetch" href="/assets/js/99.e0384484.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e5addeae.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpg" alt="从零学习大数据" class="logo"> <span class="site-name can-hide">从零学习大数据</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/frame/" class="nav-link">大数据框架</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/Yanko24" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="img/logo.jpg"> <div class="blogger-info"><h3>Yanko</h3> <span>一个大数据行业的菜鸟</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/frame/" class="nav-link">大数据框架</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/Yanko24" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flink基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flink进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Flink源码</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/46833d/" class="sidebar-link">《从0学习Flink源码》——Flink源码编译及部署</a></li><li><a href="/pages/3f76c3/" class="sidebar-link">《从0学习Flink源码》——构建源码测试环境</a></li><li><a href="/pages/271d4f/" aria-current="page" class="active sidebar-link">《从0学习Flink源码》——Flink集群启动流程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/128d25/" class="sidebar-link">《从0学习Flink源码》——JobManager启动过程</a></li><li><a href="/pages/be504e/" class="sidebar-link">《从0学习Flink源码》——TaskManager启动流程</a></li><li><a href="/pages/c5dabf/" class="sidebar-link">《从0学习Flink源码》——State</a></li><li><a href="/pages/06b4da/" class="sidebar-link">《从0学习Flink源码》——Window</a></li><li><a href="/pages/78d1d9/" class="sidebar-link">深入理解Java虚拟机</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flink面试题</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/categories/?category=%E3%80%8A%E4%BB%8E%E9%9B%B6%E5%AD%A6%E4%B9%A0Flink%E3%80%8B" title="分类" data-v-1baff76c>《从零学习Flink》</a></li><li data-v-1baff76c><a href="/categories/?category=Flink%E6%BA%90%E7%A0%81" title="分类" data-v-1baff76c>Flink源码</a></li></ul> <div class="info" data-v-1baff76c><div title="作者" class="author iconfont icon-touxiang" data-v-1baff76c><a href="https://github.com/Yanko24" target="_blank" title="作者" class="beLink" data-v-1baff76c>Yanko24</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2022-04-24</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">《从0学习Flink源码》——Flink集群启动流程<!----></h1>  <div class="theme-vdoing-content content__default"><h4 id="_1-前言"><a href="#_1-前言" class="header-anchor">#</a> 1. 前言</h4> <p>上篇文章我们看了Flink源码中的各个模块的作用，这篇文章我们一起看看flink的启动流程，大家都知道无论是local模式还是stanalone模式都是需要从<code>start-cluster.sh</code>脚本开始，今天我们就从<code>start-cluster</code>脚本看看flink集群的一个启动流程。</p> <h4 id="_2-start-cluster-sh"><a href="#_2-start-cluster-sh" class="header-anchor">#</a> 2. start-cluster.sh</h4> <p>Flink集群启动时，是通过执行命令：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 需要在flink的根目录下执行</span>
$ bin/start-cluster.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这个脚本的具体内容如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token comment"># 获取所在目录</span>
<span class="token assign-left variable">bin</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">dirname</span> <span class="token string">&quot;<span class="token variable">$0</span>&quot;</span><span class="token variable">`</span></span>
<span class="token assign-left variable">bin</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">cd</span> <span class="token string">&quot;<span class="token variable">$bin</span>&quot;</span><span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>

<span class="token comment"># 执行目录下的config.sh脚本</span>
<span class="token builtin class-name">.</span> <span class="token string">&quot;<span class="token variable">$bin</span>&quot;</span>/config.sh

<span class="token comment"># Start the JobManager instance(s)</span>
<span class="token comment"># 对比样式时忽略大小写</span>
<span class="token builtin class-name">shopt</span> -s nocasematch
<span class="token comment"># 判断是否是高可用模式的standalone模式集群，默认值为NONE，可选zookeeper</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$HIGH_AVAILABILITY</span> <span class="token operator">==</span> <span class="token string">&quot;zookeeper&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token comment"># HA Mode</span>
    <span class="token comment"># 调用config.sh中的函数获取master列表</span>
    readMasters

    <span class="token comment"># ${#MASTERS[@]}获取masters数组的长度</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Starting HA cluster with <span class="token variable">${<span class="token operator">#</span>MASTERS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span> masters.&quot;</span>

    <span class="token comment"># 标准的for循环遍历masters数组</span>
    <span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>${#MASTERS[@]}<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token assign-left variable">master</span><span class="token operator">=</span><span class="token variable">${MASTERS<span class="token punctuation">[</span>i<span class="token punctuation">]</span>}</span>
        <span class="token assign-left variable">webuiport</span><span class="token operator">=</span><span class="token variable">${WEBUIPORTS<span class="token punctuation">[</span>i<span class="token punctuation">]</span>}</span>

        <span class="token comment"># 如果MASTERS_ALL_LOCALHOST值为true，则说明配置中的masters为localhost或127.0.0.1</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">${MASTERS_ALL_LOCALHOST}</span> <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token comment"># 在本地调用jobmanager.sh脚本启动jobmanager</span>
            <span class="token string">&quot;<span class="token variable">${FLINK_BIN_DIR}</span>&quot;</span>/jobmanager.sh start <span class="token string">&quot;<span class="token variable">${master}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${webuiport}</span>&quot;</span>
        <span class="token keyword">else</span>
            <span class="token comment"># 连接远程调用jobmanager.sh脚本启动jobmanager，-n表示阻止stdin</span>
            <span class="token function">ssh</span> -n <span class="token variable">$FLINK_SSH_OPTS</span> <span class="token variable">$master</span> -- <span class="token string">&quot;nohup /bin/bash -l <span class="token entity" title="\&quot;">\&quot;</span><span class="token variable">${FLINK_BIN_DIR}</span>/jobmanager.sh<span class="token entity" title="\&quot;">\&quot;</span> start <span class="token variable">${master}</span> <span class="token variable">${webuiport}</span> &amp;&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>

<span class="token keyword">else</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Starting cluster.&quot;</span>

    <span class="token comment"># Start single JobManager on this machine</span>
    <span class="token string">&quot;<span class="token variable">$FLINK_BIN_DIR</span>&quot;</span>/jobmanager.sh start
<span class="token keyword">fi</span>
<span class="token builtin class-name">shopt</span> -u nocasematch

<span class="token comment"># Start TaskManager instance(s)</span>
<span class="token comment"># 调用脚本config.sh中的函数TMWorkers启动taskmanager</span>
TMWorkers start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h4 id="_3-config-sh"><a href="#_3-config-sh" class="header-anchor">#</a> 3. config.sh</h4> <p>脚本<code>config.sh</code>的内容如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token function-name function">constructFlinkClassPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> FLINK_DIST
    <span class="token builtin class-name">local</span> FLINK_CLASSPATH

    <span class="token keyword">while</span> <span class="token builtin class-name">read</span> -d <span class="token string">''</span> -r jarfile <span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$jarfile</span>&quot;</span> <span class="token operator">=~</span> .*/flink-dist<span class="token punctuation">[</span>^/<span class="token punctuation">]</span>*.jar$ <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token assign-left variable">FLINK_DIST</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$FLINK_DIST</span>&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;<span class="token variable">$jarfile</span>&quot;</span>
        <span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$FLINK_CLASSPATH</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token assign-left variable">FLINK_CLASSPATH</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$jarfile</span>&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token assign-left variable">FLINK_CLASSPATH</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$FLINK_CLASSPATH</span>&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;<span class="token variable">$jarfile</span>&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">find</span> <span class="token string">&quot;<span class="token variable">$FLINK_LIB_DIR</span>&quot;</span> <span class="token operator">!</span> -type d -name <span class="token string">'*.jar'</span> -print0 <span class="token operator">|</span> <span class="token function">sort</span> -z<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$FLINK_DIST</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment"># write error message to stderr since stdout is stored as the classpath</span>
        <span class="token punctuation">(</span><span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;[ERROR] Flink distribution jar not found in <span class="token variable">$FLINK_LIB_DIR</span>.&quot;</span><span class="token punctuation">)</span>

        <span class="token comment"># exit function with empty classpath to force process failure</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>

    <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$FLINK_CLASSPATH</span>&quot;</span>&quot;<span class="token variable">$FLINK_DIST</span><span class="token string">&quot;
}

findFlinkDistJar() {
    local FLINK_DIST=&quot;</span><span class="token variable"><span class="token variable">`</span><span class="token function">find</span> <span class="token string">&quot;<span class="token variable">$FLINK_LIB_DIR</span>&quot;</span> -name <span class="token string">'flink-dist*.jar'</span><span class="token variable">`</span></span><span class="token string">&quot;

    if [[ &quot;</span><span class="token variable">$FLINK_DIST</span><span class="token string">&quot; == &quot;</span>&quot; <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment"># write error message to stderr since stdout is stored as the classpath</span>
        <span class="token punctuation">(</span><span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;[ERROR] Flink distribution jar not found in <span class="token variable">$FLINK_LIB_DIR</span>.&quot;</span><span class="token punctuation">)</span>

        <span class="token comment"># exit function with empty classpath to force process failure</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>

    <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$FLINK_DIST</span>&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># These are used to mangle paths that are passed to java when using</span>
<span class="token comment"># cygwin. Cygwin paths are like linux paths, i.e. /path/to/somewhere</span>
<span class="token comment"># but the windows java version expects them in Windows Format, i.e. C:\bla\blub.</span>
<span class="token comment"># &quot;cygpath&quot; can do the conversion.</span>
<span class="token function-name function">manglePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token assign-left variable">UNAME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${UNAME<span class="token operator">:</span>0<span class="token operator">:</span>6}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;CYGWIN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">`</span>cygpath -w <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span><span class="token variable">`</span></span>
    <span class="token keyword">else</span>
        <span class="token builtin class-name">echo</span> <span class="token variable">$1</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token function-name function">manglePathList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token assign-left variable">UNAME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>
    <span class="token comment"># a path list, for example a java classpath</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${UNAME<span class="token operator">:</span>0<span class="token operator">:</span>6}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;CYGWIN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">`</span>cygpath -wp <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span><span class="token variable">`</span></span>
    <span class="token keyword">else</span>
        <span class="token builtin class-name">echo</span> <span class="token variable">$1</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Looks up a config value by key from a simple YAML-style key-value map.</span>
<span class="token comment"># $1: key to look up</span>
<span class="token comment"># $2: default value to return if key does not exist</span>
<span class="token comment"># $3: config file to read from</span>
<span class="token comment"># 从yaml样式的文件中按照key读取值，如果没有就赋值默认值</span>
<span class="token function-name function">readFromConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">key</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">defaultValue</span><span class="token operator">=</span><span class="token variable">$2</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">configFile</span><span class="token operator">=</span><span class="token variable">$3</span>

    <span class="token comment"># first extract the value with the given key (1st sed), then trim the result (2nd sed)</span>
    <span class="token comment"># if a key exists multiple times, take the &quot;last&quot; one (tail)</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">sed</span> -n <span class="token string">&quot;s/^[ ]*<span class="token variable">${key}</span>[ ]*: \([^#]*\).*$/<span class="token entity" title="\1">\1</span>/p&quot;</span> <span class="token string">&quot;<span class="token variable">${configFile}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">&quot;s/^ *//;s/ *$//&quot;</span> <span class="token operator">|</span> <span class="token function">tail</span> -n <span class="token number">1</span><span class="token variable">`</span></span>

    <span class="token comment"># 如果获取到了值value，就对外输出value，否则输出默认值</span>
    <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$value</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$defaultValue</span>&quot;</span> <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$value</span>&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">########################################################################################################################</span>
<span class="token comment"># DEFAULT CONFIG VALUES: These values will be used when nothing has been specified in conf/flink-conf.yaml</span>
<span class="token comment"># -or- the respective environment variables are not set.</span>
<span class="token comment">########################################################################################################################</span>


<span class="token comment"># WARNING !!! , these values are only used if there is nothing else is specified in</span>
<span class="token comment"># conf/flink-conf.yaml</span>

<span class="token assign-left variable">DEFAULT_ENV_PID_DIR</span><span class="token operator">=</span><span class="token string">&quot;/tmp&quot;</span>                          <span class="token comment"># Directory to store *.pid files to</span>
<span class="token assign-left variable">DEFAULT_ENV_LOG_MAX</span><span class="token operator">=</span><span class="token number">10</span>                              <span class="token comment"># Maximum number of old log files to keep</span>
<span class="token assign-left variable">DEFAULT_ENV_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>                            <span class="token comment"># Optional JVM args</span>
<span class="token assign-left variable">DEFAULT_ENV_JAVA_OPTS_JM</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>                         <span class="token comment"># Optional JVM args (JobManager)</span>
<span class="token assign-left variable">DEFAULT_ENV_JAVA_OPTS_TM</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>                         <span class="token comment"># Optional JVM args (TaskManager)</span>
<span class="token assign-left variable">DEFAULT_ENV_JAVA_OPTS_HS</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>                         <span class="token comment"># Optional JVM args (HistoryServer)</span>
<span class="token assign-left variable">DEFAULT_ENV_JAVA_OPTS_CLI</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>                        <span class="token comment"># Optional JVM args (Client)</span>
<span class="token assign-left variable">DEFAULT_ENV_SSH_OPTS</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>                             <span class="token comment"># Optional SSH parameters running in cluster mode</span>
<span class="token assign-left variable">DEFAULT_YARN_CONF_DIR</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>                            <span class="token comment"># YARN Configuration Directory, if necessary</span>
<span class="token assign-left variable">DEFAULT_HADOOP_CONF_DIR</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>                          <span class="token comment"># Hadoop Configuration Directory, if necessary</span>
<span class="token assign-left variable">DEFAULT_HBASE_CONF_DIR</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>                           <span class="token comment"># HBase Configuration Directory, if necessary</span>

<span class="token comment">########################################################################################################################</span>
<span class="token comment"># CONFIG KEYS: The default values can be overwritten by the following keys in conf/flink-conf.yaml</span>
<span class="token comment">########################################################################################################################</span>

<span class="token assign-left variable">KEY_TASKM_COMPUTE_NUMA</span><span class="token operator">=</span><span class="token string">&quot;taskmanager.compute.numa&quot;</span>

<span class="token assign-left variable">KEY_ENV_PID_DIR</span><span class="token operator">=</span><span class="token string">&quot;env.pid.dir&quot;</span>
<span class="token assign-left variable">KEY_ENV_LOG_DIR</span><span class="token operator">=</span><span class="token string">&quot;env.log.dir&quot;</span>
<span class="token assign-left variable">KEY_ENV_LOG_MAX</span><span class="token operator">=</span><span class="token string">&quot;env.log.max&quot;</span>
<span class="token assign-left variable">KEY_ENV_YARN_CONF_DIR</span><span class="token operator">=</span><span class="token string">&quot;env.yarn.conf.dir&quot;</span>
<span class="token assign-left variable">KEY_ENV_HADOOP_CONF_DIR</span><span class="token operator">=</span><span class="token string">&quot;env.hadoop.conf.dir&quot;</span>
<span class="token assign-left variable">KEY_ENV_HBASE_CONF_DIR</span><span class="token operator">=</span><span class="token string">&quot;env.hbase.conf.dir&quot;</span>
<span class="token assign-left variable">KEY_ENV_JAVA_HOME</span><span class="token operator">=</span><span class="token string">&quot;env.java.home&quot;</span>
<span class="token assign-left variable">KEY_ENV_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;env.java.opts&quot;</span>
<span class="token assign-left variable">KEY_ENV_JAVA_OPTS_JM</span><span class="token operator">=</span><span class="token string">&quot;env.java.opts.jobmanager&quot;</span>
<span class="token assign-left variable">KEY_ENV_JAVA_OPTS_TM</span><span class="token operator">=</span><span class="token string">&quot;env.java.opts.taskmanager&quot;</span>
<span class="token assign-left variable">KEY_ENV_JAVA_OPTS_HS</span><span class="token operator">=</span><span class="token string">&quot;env.java.opts.historyserver&quot;</span>
<span class="token assign-left variable">KEY_ENV_JAVA_OPTS_CLI</span><span class="token operator">=</span><span class="token string">&quot;env.java.opts.client&quot;</span>
<span class="token assign-left variable">KEY_ENV_SSH_OPTS</span><span class="token operator">=</span><span class="token string">&quot;env.ssh.opts&quot;</span>
<span class="token assign-left variable">KEY_HIGH_AVAILABILITY</span><span class="token operator">=</span><span class="token string">&quot;high-availability&quot;</span>
<span class="token assign-left variable">KEY_ZK_HEAP_MB</span><span class="token operator">=</span><span class="token string">&quot;zookeeper.heap.mb&quot;</span>

<span class="token comment">########################################################################################################################</span>
<span class="token comment"># PATHS AND CONFIG</span>
<span class="token comment">########################################################################################################################</span>

<span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$0</span>&quot;</span>
<span class="token comment"># For the case, the executable has been directly symlinked, figure out</span>
<span class="token comment"># the correct bin path by following its symlink up to an upper bound.</span>
<span class="token comment"># Note: we can't use the readlink utility here if we want to be POSIX</span>
<span class="token comment"># compatible.</span>
<span class="token assign-left variable">iteration</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span> -L <span class="token string">&quot;<span class="token variable">$target</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$iteration</span>&quot;</span> -gt <span class="token number">100</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;Cannot resolve path: You have a cyclic symlink in <span class="token variable">$target</span>.&quot;</span>
        <span class="token builtin class-name">break</span>
    <span class="token keyword">fi</span>
    <span class="token assign-left variable">ls</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ls</span> -ld -- <span class="token string">&quot;<span class="token variable">$target</span>&quot;</span><span class="token variable">`</span></span>
    <span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">expr</span> <span class="token string">&quot;<span class="token variable">$ls</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">'.* -&gt; \(.*\)$'</span><span class="token variable">`</span></span>
    <span class="token assign-left variable">iteration</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>iteration <span class="token operator">+</span> <span class="token number">1</span><span class="token variable">))</span></span>
<span class="token keyword">done</span>

<span class="token comment"># Convert relative path to absolute path and resolve directory symlinks</span>
<span class="token assign-left variable">bin</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">dirname</span> <span class="token string">&quot;<span class="token variable">$target</span>&quot;</span><span class="token variable">`</span></span>
<span class="token assign-left variable">SYMLINK_RESOLVED_BIN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">cd</span> <span class="token string">&quot;<span class="token variable">$bin</span>&quot;</span><span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span> -P<span class="token variable">`</span></span>

<span class="token comment"># Define the main directory of the flink installation</span>
<span class="token comment"># If config.sh is called by pyflink-shell.sh in python bin directory(pip installed), then do not need to set the FLINK_HOME here.</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$_FLINK_HOME_DETERMINED</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">FLINK_HOME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">dirname</span> <span class="token string">&quot;<span class="token variable">$SYMLINK_RESOLVED_BIN</span>&quot;</span><span class="token variable">`</span></span>
<span class="token keyword">fi</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$FLINK_LIB_DIR</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token assign-left variable">FLINK_LIB_DIR</span><span class="token operator">=</span><span class="token variable">$FLINK_HOME</span>/lib<span class="token punctuation">;</span> <span class="token keyword">fi</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$FLINK_PLUGINS_DIR</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token assign-left variable">FLINK_PLUGINS_DIR</span><span class="token operator">=</span><span class="token variable">$FLINK_HOME</span>/plugins<span class="token punctuation">;</span> <span class="token keyword">fi</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$FLINK_OPT_DIR</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token assign-left variable">FLINK_OPT_DIR</span><span class="token operator">=</span><span class="token variable">$FLINK_HOME</span>/opt<span class="token punctuation">;</span> <span class="token keyword">fi</span>


<span class="token comment"># These need to be mangled because they are directly passed to java.</span>
<span class="token comment"># The above lib path is used by the shell script to retrieve jars in a</span>
<span class="token comment"># directory, so it needs to be unmangled.</span>
<span class="token assign-left variable">FLINK_HOME_DIR_MANGLED</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>manglePath <span class="token string">&quot;<span class="token variable">$FLINK_HOME</span>&quot;</span><span class="token variable">`</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$FLINK_CONF_DIR</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token assign-left variable">FLINK_CONF_DIR</span><span class="token operator">=</span><span class="token variable">$FLINK_HOME_DIR_MANGLED</span>/conf<span class="token punctuation">;</span> <span class="token keyword">fi</span>
<span class="token assign-left variable">FLINK_BIN_DIR</span><span class="token operator">=</span><span class="token variable">$FLINK_HOME_DIR_MANGLED</span>/bin
<span class="token assign-left variable">DEFAULT_FLINK_LOG_DIR</span><span class="token operator">=</span><span class="token variable">$FLINK_HOME_DIR_MANGLED</span>/log
<span class="token assign-left variable">FLINK_CONF_FILE</span><span class="token operator">=</span><span class="token string">&quot;flink-conf.yaml&quot;</span>
<span class="token comment"># flink的默认配置文件</span>
<span class="token assign-left variable">YAML_CONF</span><span class="token operator">=</span><span class="token variable">${FLINK_CONF_DIR}</span>/<span class="token variable">${FLINK_CONF_FILE}</span>

<span class="token comment">### Exported environment variables ###</span>
<span class="token builtin class-name">export</span> FLINK_CONF_DIR
<span class="token builtin class-name">export</span> FLINK_BIN_DIR
<span class="token builtin class-name">export</span> FLINK_PLUGINS_DIR
<span class="token comment"># export /lib dir to access it during deployment of the Yarn staging files</span>
<span class="token builtin class-name">export</span> FLINK_LIB_DIR
<span class="token comment"># export /opt dir to access it for the SQL client</span>
<span class="token builtin class-name">export</span> FLINK_OPT_DIR

<span class="token comment">########################################################################################################################</span>
<span class="token comment"># ENVIRONMENT VARIABLES</span>
<span class="token comment">########################################################################################################################</span>

<span class="token comment"># read JAVA_HOME from config with no default value</span>
<span class="token assign-left variable">MY_JAVA_HOME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_JAVA_HOME<span class="token punctuation">}</span> <span class="token string">&quot;&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
<span class="token comment"># check if config specified JAVA_HOME</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${MY_JAVA_HOME}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token comment"># config did not specify JAVA_HOME. Use system JAVA_HOME</span>
    <span class="token assign-left variable">MY_JAVA_HOME</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_HOME}</span>&quot;</span>
<span class="token keyword">fi</span>
<span class="token comment"># check if we have a valid JAVA_HOME and if java is not available</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${MY_JAVA_HOME}</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token builtin class-name">type</span> java <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Please specify JAVA_HOME. Either in Flink config ./conf/flink-conf.yaml or as system-wide JAVA_HOME.&quot;</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">else</span>
    <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${MY_JAVA_HOME}</span>&quot;</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">UNAME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${UNAME<span class="token operator">:</span>0<span class="token operator">:</span>6}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;CYGWIN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">JAVA_RUN</span><span class="token operator">=</span>java
<span class="token keyword">else</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$JAVA_HOME</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">JAVA_RUN</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$JAVA_HOME</span>&quot;</span>/bin/java
    <span class="token keyword">else</span>
        <span class="token assign-left variable">JAVA_RUN</span><span class="token operator">=</span>java
    <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token comment"># Define HOSTNAME if it is not already set</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${<span class="token environment constant">HOSTNAME</span>}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable"><span class="token environment constant">HOSTNAME</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">hostname</span><span class="token variable">`</span></span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">IS_NUMBER</span><span class="token operator">=</span><span class="token string">&quot;^[0-9]+$&quot;</span>

<span class="token comment"># Verify that NUMA tooling is available</span>
<span class="token builtin class-name">command</span> -v numactl <span class="token operator">&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">FLINK_TM_COMPUTE_NUMA</span><span class="token operator">=</span><span class="token string">&quot;false&quot;</span>
<span class="token keyword">else</span>
    <span class="token comment"># Define FLINK_TM_COMPUTE_NUMA if it is not already set</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FLINK_TM_COMPUTE_NUMA}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">FLINK_TM_COMPUTE_NUMA</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_TASKM_COMPUTE_NUMA<span class="token punctuation">}</span> <span class="token string">&quot;false&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
    <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${MAX_LOG_FILE_NUMBER}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">MAX_LOG_FILE_NUMBER</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_LOG_MAX<span class="token punctuation">}</span> $<span class="token punctuation">{</span>DEFAULT_ENV_LOG_MAX<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">export</span> MAX_LOG_FILE_NUMBER
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FLINK_LOG_DIR}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">FLINK_LOG_DIR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_LOG_DIR<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${DEFAULT_FLINK_LOG_DIR}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${YARN_CONF_DIR}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">YARN_CONF_DIR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_YARN_CONF_DIR<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${DEFAULT_YARN_CONF_DIR}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${HADOOP_CONF_DIR}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">HADOOP_CONF_DIR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_HADOOP_CONF_DIR<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${DEFAULT_HADOOP_CONF_DIR}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${HBASE_CONF_DIR}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">HBASE_CONF_DIR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_HBASE_CONF_DIR<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${DEFAULT_HBASE_CONF_DIR}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FLINK_PID_DIR}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">FLINK_PID_DIR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_PID_DIR<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${DEFAULT_ENV_PID_DIR}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_JAVA_OPTS<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${DEFAULT_ENV_JAVA_OPTS}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>

    <span class="token comment"># Remove leading and ending double quotes (if present) of value</span>
    <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span>  -e <span class="token string">'s/&quot;$//'</span> <span class="token variable">)</span></span>&quot;</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS_JM}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS_JM</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_JAVA_OPTS_JM<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${DEFAULT_ENV_JAVA_OPTS_JM}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
    <span class="token comment"># Remove leading and ending double quotes (if present) of value</span>
    <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS_JM</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS_JM}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span>  -e <span class="token string">'s/&quot;$//'</span> <span class="token variable">)</span></span>&quot;</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS_TM}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS_TM</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_JAVA_OPTS_TM<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${DEFAULT_ENV_JAVA_OPTS_TM}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
    <span class="token comment"># Remove leading and ending double quotes (if present) of value</span>
    <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS_TM</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS_TM}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span>  -e <span class="token string">'s/&quot;$//'</span> <span class="token variable">)</span></span>&quot;</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS_HS}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS_HS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_JAVA_OPTS_HS<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${DEFAULT_ENV_JAVA_OPTS_HS}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
    <span class="token comment"># Remove leading and ending double quotes (if present) of value</span>
    <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS_HS</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS_HS}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span>  -e <span class="token string">'s/&quot;$//'</span> <span class="token variable">)</span></span>&quot;</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS_CLI}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS_CLI</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_JAVA_OPTS_CLI<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${DEFAULT_ENV_JAVA_OPTS_CLI}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
    <span class="token comment"># Remove leading and ending double quotes (if present) of value</span>
    <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS_CLI</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS_CLI}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span>  -e <span class="token string">'s/&quot;$//'</span> <span class="token variable">)</span></span>&quot;</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FLINK_SSH_OPTS}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">FLINK_SSH_OPTS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ENV_SSH_OPTS<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${DEFAULT_ENV_SSH_OPTS}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
<span class="token keyword">fi</span>

<span class="token comment"># Define ZK_HEAP if it is not already set</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${ZK_HEAP}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">ZK_HEAP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_ZK_HEAP_MB<span class="token punctuation">}</span> <span class="token number">0</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
<span class="token keyword">fi</span>

<span class="token comment"># High availability</span>
<span class="token comment"># 判断当HIGH_AVAILABILITY长度为0时，则为真</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${HIGH_AVAILABILITY}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
     <span class="token comment"># 调用函数readFromConfig读取配置中的值赋值给HIGH_AVAILABILITY，如果没有就默认值为空</span>
     <span class="token assign-left variable">HIGH_AVAILABILITY</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig $<span class="token punctuation">{</span>KEY_HIGH_AVAILABILITY<span class="token punctuation">}</span> <span class="token string">&quot;&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
     <span class="token comment"># 如果HIGH_AVAILABILITY值还为空，则尝试其他不推荐的值</span>
     <span class="token comment"># 没有修改flink-conf中high-availability的值那就默认为none，即local模式启动</span>
     <span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${HIGH_AVAILABILITY}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment"># Try deprecated value</span>
        <span class="token assign-left variable">DEPRECATED_HA</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>readFromConfig <span class="token string">&quot;recovery.mode&quot;</span> <span class="token string">&quot;&quot;</span> <span class="token string">&quot;<span class="token variable">${YAML_CONF}</span>&quot;</span><span class="token variable">)</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${DEPRECATED_HA}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token assign-left variable">HIGH_AVAILABILITY</span><span class="token operator">=</span><span class="token string">&quot;none&quot;</span>
        <span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">${DEPRECATED_HA}</span> <span class="token operator">==</span> <span class="token string">&quot;standalone&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token comment"># Standalone is now 'none'</span>
            <span class="token assign-left variable">HIGH_AVAILABILITY</span><span class="token operator">=</span><span class="token string">&quot;none&quot;</span>
        <span class="token keyword">else</span>
            <span class="token assign-left variable">HIGH_AVAILABILITY</span><span class="token operator">=</span><span class="token variable">${DEPRECATED_HA}</span>
        <span class="token keyword">fi</span>
     <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token comment"># Arguments for the JVM. Used for job and task manager JVMs.</span>
<span class="token comment"># DO NOT USE FOR MEMORY SETTINGS! Use conf/flink-conf.yaml with keys</span>
<span class="token comment"># JobManagerOptions#TOTAL_PROCESS_MEMORY and TaskManagerOptions#TOTAL_PROCESS_MEMORY for that!</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${JVM_ARGS}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">JVM_ARGS</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
<span class="token keyword">fi</span>

<span class="token comment"># Check if deprecated HADOOP_HOME is set, and specify config path to HADOOP_CONF_DIR if it's empty.</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$HADOOP_CONF_DIR</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$HADOOP_HOME</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment"># HADOOP_HOME is set. Check if its a Hadoop 1.x or 2.x HADOOP_HOME path</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$HADOOP_HOME</span>/conf&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token comment"># It's Hadoop 1.x</span>
            <span class="token assign-left variable">HADOOP_CONF_DIR</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$HADOOP_HOME</span>/conf&quot;</span>
        <span class="token keyword">fi</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$HADOOP_HOME</span>/etc/hadoop&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token comment"># It's Hadoop 2.2+</span>
            <span class="token assign-left variable">HADOOP_CONF_DIR</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$HADOOP_HOME</span>/etc/hadoop&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token comment"># if neither HADOOP_CONF_DIR nor HADOOP_CLASSPATH are set, use some common default (if available)</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$HADOOP_CONF_DIR</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$HADOOP_CLASSPATH</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;/etc/hadoop/conf&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;Setting HADOOP_CONF_DIR=/etc/hadoop/conf because no HADOOP_CONF_DIR or HADOOP_CLASSPATH was set.&quot;</span>
        <span class="token assign-left variable">HADOOP_CONF_DIR</span><span class="token operator">=</span><span class="token string">&quot;/etc/hadoop/conf&quot;</span>
    <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token comment"># Check if deprecated HBASE_HOME is set, and specify config path to HBASE_CONF_DIR if it's empty.</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$HBASE_CONF_DIR</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$HBASE_HOME</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment"># HBASE_HOME is set.</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$HBASE_HOME</span>/conf&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token assign-left variable">HBASE_CONF_DIR</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$HBASE_HOME</span>/conf&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token comment"># try and set HBASE_CONF_DIR to some common default if it's not set</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$HBASE_CONF_DIR</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;/etc/hbase/conf&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;Setting HBASE_CONF_DIR=/etc/hbase/conf because no HBASE_CONF_DIR was set.&quot;</span>
        <span class="token assign-left variable">HBASE_CONF_DIR</span><span class="token operator">=</span><span class="token string">&quot;/etc/hbase/conf&quot;</span>
    <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">INTERNAL_HADOOP_CLASSPATHS</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${HADOOP_CLASSPATH}</span>:<span class="token variable">${HADOOP_CONF_DIR}</span>:<span class="token variable">${YARN_CONF_DIR}</span>&quot;</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">${HBASE_CONF_DIR}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">INTERNAL_HADOOP_CLASSPATHS</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${INTERNAL_HADOOP_CLASSPATHS}</span>:<span class="token variable">${HBASE_CONF_DIR}</span>&quot;</span>
<span class="token keyword">fi</span>

<span class="token comment"># Auxilliary function which extracts the name of host from a line which</span>
<span class="token comment"># also potentially includes topology information and the taskManager type</span>
<span class="token function-name function">extractHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># handle comments: extract first part of string (before first # character)</span>
    <span class="token assign-left variable">WORKER</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $1 <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">'#'</span> -f <span class="token number">1</span><span class="token variable">`</span></span>

    <span class="token comment"># Extract the hostname from the network hierarchy</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$WORKER</span>&quot;</span> <span class="token operator">=~</span> ^.*/<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span>-9a-zA-Z.-<span class="token punctuation">]</span>+<span class="token punctuation">)</span>$ <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token assign-left variable">WORKER</span><span class="token operator">=</span><span class="token variable">${<span class="token environment constant">BASH_REMATCH</span><span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>
    <span class="token keyword">fi</span>

    <span class="token builtin class-name">echo</span> <span class="token variable">$WORKER</span>
<span class="token punctuation">}</span>

<span class="token function-name function">readMasters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token assign-left variable">MASTERS_FILE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${FLINK_CONF_DIR}</span>/masters&quot;</span>

    <span class="token comment"># 判断文件masters是否存在，如果不存在则为真</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> -f <span class="token string">&quot;<span class="token variable">${MASTERS_FILE}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;No masters file. Please specify masters in 'conf/masters'.&quot;</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>

    <span class="token comment"># 定义数组</span>
    <span class="token assign-left variable">MASTERS</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token assign-left variable">WEBUIPORTS</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token assign-left variable">MASTERS_ALL_LOCALHOST</span><span class="token operator">=</span>true
    <span class="token assign-left variable">GOON</span><span class="token operator">=</span>true
    <span class="token keyword">while</span> <span class="token variable">$GOON</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token builtin class-name">read</span> line <span class="token operator">||</span> <span class="token assign-left variable">GOON</span><span class="token operator">=</span>false
        <span class="token assign-left variable">HOSTWEBUIPORT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span> extractHostName $line<span class="token variable">)</span></span>

        <span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$HOSTWEBUIPORT</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token assign-left variable">HOST</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $HOSTWEBUIPORT <span class="token operator">|</span> <span class="token function">cut</span> -f1 -d:<span class="token variable">)</span></span>
            <span class="token assign-left variable">WEBUIPORT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $HOSTWEBUIPORT <span class="token operator">|</span> <span class="token function">cut</span> -s -f2 -d:<span class="token variable">)</span></span>
            <span class="token assign-left variable">MASTERS</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token variable">${HOST}</span><span class="token punctuation">)</span>

            <span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$WEBUIPORT</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token assign-left variable">WEBUIPORTS</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span>
                <span class="token assign-left variable">WEBUIPORTS</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token variable">${WEBUIPORT}</span><span class="token punctuation">)</span>
            <span class="token keyword">fi</span>

            <span class="token comment"># 如果HOST不是localhost或者127.0.0.1，则赋值MASTERS_ALL_LOCALHOST为false</span>
            <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${HOST}</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;localhost&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${HOST}</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;127.0.0.1&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token assign-left variable">MASTERS_ALL_LOCALHOST</span><span class="token operator">=</span>false
            <span class="token keyword">fi</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token string">&quot;<span class="token variable">$MASTERS_FILE</span>&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 读取workers配置</span>
<span class="token function-name function">readWorkers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token assign-left variable">WORKERS_FILE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${FLINK_CONF_DIR}</span>/workers&quot;</span>

    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> -f <span class="token string">&quot;<span class="token variable">$WORKERS_FILE</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;No workers file. Please specify workers in 'conf/workers'.&quot;</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>

    <span class="token assign-left variable">WORKERS</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token assign-left variable">WORKERS_ALL_LOCALHOST</span><span class="token operator">=</span>true
    <span class="token assign-left variable">GOON</span><span class="token operator">=</span>true
    <span class="token keyword">while</span> <span class="token variable">$GOON</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token builtin class-name">read</span> line <span class="token operator">||</span> <span class="token assign-left variable">GOON</span><span class="token operator">=</span>false
        <span class="token assign-left variable">HOST</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span> extractHostName $line<span class="token variable">)</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$HOST</span>&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token assign-left variable">WORKERS</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token variable">${HOST}</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${HOST}</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;localhost&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${HOST}</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;127.0.0.1&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token assign-left variable">WORKERS_ALL_LOCALHOST</span><span class="token operator">=</span>false
            <span class="token keyword">fi</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token string">&quot;<span class="token variable">$WORKERS_FILE</span>&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># starts or stops TMs on all workers</span>
<span class="token comment"># TMWorkers start|stop</span>
<span class="token function-name function">TMWorkers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token assign-left variable">CMD</span><span class="token operator">=</span><span class="token variable">$1</span>

    readWorkers

    <span class="token comment"># workers中配置了本地localhost或127.0.0.1</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">${WORKERS_ALL_LOCALHOST}</span> <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment"># all-local setup</span>
        <span class="token comment"># 循环遍历workers数组，for in</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">worker</span> <span class="token keyword">in</span> <span class="token variable">${WORKERS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
            <span class="token string">&quot;<span class="token variable">${FLINK_BIN_DIR}</span>&quot;</span>/taskmanager.sh <span class="token string">&quot;<span class="token variable">${CMD}</span>&quot;</span>
        <span class="token keyword">done</span>
    <span class="token keyword">else</span>
        <span class="token comment"># non-local setup</span>
        <span class="token comment"># start/stop TaskManager instance(s) using pdsh (Parallel Distributed Shell) when available</span>
        <span class="token builtin class-name">command</span> -v pdsh <span class="token operator">&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token keyword">for</span> <span class="token for-or-select variable">worker</span> <span class="token keyword">in</span> <span class="token variable">${WORKERS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
                <span class="token comment"># 远程启动taskmanager节点</span>
                <span class="token function">ssh</span> -n <span class="token variable">$FLINK_SSH_OPTS</span> <span class="token variable">$worker</span> -- <span class="token string">&quot;nohup /bin/bash -l <span class="token entity" title="\&quot;">\&quot;</span><span class="token variable">${FLINK_BIN_DIR}</span>/taskmanager.sh<span class="token entity" title="\&quot;">\&quot;</span> <span class="token entity" title="\&quot;">\&quot;</span><span class="token variable">${CMD}</span><span class="token entity" title="\&quot;">\&quot;</span> &amp;&quot;</span>
            <span class="token keyword">done</span>
        <span class="token keyword">else</span>
            <span class="token assign-left variable">PDSH_SSH_ARGS</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span> <span class="token assign-left variable">PDSH_SSH_ARGS_APPEND</span><span class="token operator">=</span><span class="token variable">$FLINK_SSH_OPTS</span> pdsh -w <span class="token variable"><span class="token variable">$(</span><span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span>, <span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${WORKERS<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>&quot;</span><span class="token variable">)</span></span> <span class="token punctuation">\</span>
                <span class="token string">&quot;nohup /bin/bash -l <span class="token entity" title="\&quot;">\&quot;</span><span class="token variable">${FLINK_BIN_DIR}</span>/taskmanager.sh<span class="token entity" title="\&quot;">\&quot;</span> <span class="token entity" title="\&quot;">\&quot;</span><span class="token variable">${CMD}</span><span class="token entity" title="\&quot;">\&quot;</span>&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token function-name function">runBashJavaUtilsCmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">conf_dir</span><span class="token operator">=</span><span class="token variable">$2</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">class_path</span><span class="token operator">=</span><span class="token variable">$3</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">dynamic_args</span><span class="token operator">=</span><span class="token variable">${@<span class="token operator">:</span>4}</span>
    <span class="token assign-left variable">class_path</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>manglePathList <span class="token string">&quot;<span class="token variable">${class_path}</span>&quot;</span><span class="token variable">`</span></span>

    <span class="token builtin class-name">local</span> <span class="token assign-left variable">output</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>&quot;$<span class="token punctuation">{</span>JAVA_RUN<span class="token punctuation">}</span><span class="token string">&quot; -classpath &quot;</span>$<span class="token punctuation">{</span>class_path<span class="token punctuation">}</span><span class="token string">&quot; org.apache.flink.runtime.util.bash.BashJavaUtils <span class="token variable">${cmd}</span> --configDir &quot;</span>$<span class="token punctuation">{</span>conf_dir<span class="token punctuation">}</span>&quot; $dynamic_args <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">tail</span> -n <span class="token number">1000</span><span class="token variable">`</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;[ERROR] Cannot run BashJavaUtils to execute command <span class="token variable">${cmd}</span>.&quot;</span> <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token file-descriptor important">&amp;2</span>
        <span class="token comment"># Print the output in case the user redirect the log to console.</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$output</span>&quot;</span> <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token file-descriptor important">&amp;2</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>

    <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$output</span>&quot;</span>
<span class="token punctuation">}</span>

<span class="token function-name function">extractExecutionResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">output</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">expected_lines</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$2</span>&quot;</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">EXECUTION_PREFIX</span><span class="token operator">=</span><span class="token string">&quot;BASH_JAVA_UTILS_EXEC_RESULT:&quot;</span>
    <span class="token builtin class-name">local</span> execution_results
    <span class="token builtin class-name">local</span> num_lines

    <span class="token assign-left variable">execution_results</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${output}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> $<span class="token punctuation">{</span>EXECUTION_PREFIX<span class="token punctuation">}</span><span class="token variable">)</span></span>
    <span class="token assign-left variable">num_lines</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${execution_results}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">wc</span> -l<span class="token variable">)</span></span>
    <span class="token comment"># explicit check for empty result, becuase if execution_results is empty, then wc returns 1</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token variable">${execution_results}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;[ERROR] The execution result is empty.&quot;</span> <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token file-descriptor important">&amp;2</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">${num_lines}</span> -ne <span class="token variable">${expected_lines}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;[ERROR] The execution results has unexpected number of lines, expected: <span class="token variable">${expected_lines}</span>, actual: <span class="token variable">${num_lines}</span>.&quot;</span> <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token file-descriptor important">&amp;2</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;[ERROR] An execution result line is expected following the prefix '<span class="token variable">${EXECUTION_PREFIX}</span>'&quot;</span> <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token file-descriptor important">&amp;2</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$output</span>&quot;</span> <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token file-descriptor important">&amp;2</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>

    <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${execution_results<span class="token operator">/</span><span class="token operator">/</span>${EXECUTION_PREFIX}</span>/}&quot;</span>
<span class="token punctuation">}</span>

<span class="token function-name function">extractLoggingOutputs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">output</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">EXECUTION_PREFIX</span><span class="token operator">=</span><span class="token string">&quot;BASH_JAVA_UTILS_EXEC_RESULT:&quot;</span>

    <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${output}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> -v <span class="token variable">${EXECUTION_PREFIX}</span>
<span class="token punctuation">}</span>

<span class="token function-name function">parseResourceParamsAndExportLogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token variable">$1</span>
  <span class="token assign-left variable">java_utils_output</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>runBashJavaUtilsCmd $<span class="token punctuation">{</span>cmd<span class="token punctuation">}</span> <span class="token string">&quot;<span class="token variable">${FLINK_CONF_DIR}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${FLINK_BIN_DIR}</span>/bash-java-utils.jar:<span class="token variable"><span class="token variable">$(</span>findFlinkDistJar<span class="token variable">)</span></span>&quot;</span> <span class="token string">&quot;<span class="token variable">${@<span class="token operator">:</span>2}</span>&quot;</span><span class="token variable">)</span></span>
  <span class="token assign-left variable">logging_output</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>extractLoggingOutputs <span class="token string">&quot;<span class="token variable">${java_utils_output}</span>&quot;</span><span class="token variable">)</span></span>
  <span class="token assign-left variable">params_output</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>extractExecutionResults <span class="token string">&quot;<span class="token variable">${java_utils_output}</span>&quot;</span> <span class="token number">2</span><span class="token variable">)</span></span>

  <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;[ERROR] Could not get JVM parameters and dynamic configurations properly.&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;[ERROR] Raw output from BashJavaUtils:&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$java_utils_output</span>&quot;</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
  <span class="token keyword">fi</span>

  <span class="token assign-left variable">jvm_params</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${params_output}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">head</span> -n1<span class="token variable">)</span></span>
  <span class="token builtin class-name">export</span> <span class="token assign-left variable">JVM_ARGS</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JVM_ARGS}</span> <span class="token variable">${jvm_params}</span>&quot;</span>
  <span class="token builtin class-name">export</span> <span class="token assign-left variable">DYNAMIC_PARAMETERS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">&quot; &quot;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${params_output}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">tail</span> -n1<span class="token variable">)</span></span>

  <span class="token builtin class-name">export</span> <span class="token assign-left variable">FLINK_INHERITED_LOGS</span><span class="token operator">=</span><span class="token string">&quot;
<span class="token variable">$FLINK_INHERITED_LOGS</span>

RESOURCE_PARAMS extraction logs:
jvm_params: <span class="token variable">$jvm_params</span>
dynamic_configs: <span class="token variable">$DYNAMIC_PARAMETERS</span>
logs: <span class="token variable">$logging_output</span>
&quot;</span>
<span class="token punctuation">}</span>

<span class="token function-name function">parseJmArgsAndExportLogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  parseResourceParamsAndExportLogs GET_JM_RESOURCE_PARAMS <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
<span class="token punctuation">}</span>

<span class="token function-name function">parseTmArgsAndExportLogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  parseResourceParamsAndExportLogs GET_TM_RESOURCE_PARAMS <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br></div></div><p>脚本config.sh中包含了很多读取配置文件、加载环境变量等工作，主要是为了为后续的启动提供基本保障。可以看看config.sh脚本的内容，从中可以学习到很多shell脚本的知识。</p> <h4 id="_4-jobmanager-sh"><a href="#_4-jobmanager-sh" class="header-anchor">#</a> 4. jobmanager.sh</h4> <p>脚本jobmanager，主要启动jobmanager的，内容如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token comment"># Start/stop a Flink JobManager.</span>
<span class="token comment"># 在执行的host和port上启动jobmanager</span>
<span class="token assign-left variable">USAGE</span><span class="token operator">=</span><span class="token string">&quot;Usage: jobmanager.sh ((start|start-foreground) [host] [webui-port])|stop|stop-all&quot;</span>

<span class="token assign-left variable">STARTSTOP</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">HOST</span><span class="token operator">=</span><span class="token variable">$2</span> <span class="token comment"># optional when starting multiple instances</span>
<span class="token assign-left variable">WEBUIPORT</span><span class="token operator">=</span><span class="token variable">$3</span> <span class="token comment"># optional when starting multiple instances</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">!=</span> <span class="token string">&quot;start&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">!=</span> <span class="token string">&quot;start-foreground&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">!=</span> <span class="token string">&quot;stop&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">!=</span> <span class="token string">&quot;stop-all&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token variable">$USAGE</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">bin</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">dirname</span> <span class="token string">&quot;<span class="token variable">$0</span>&quot;</span><span class="token variable">`</span></span>
<span class="token assign-left variable">bin</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">cd</span> <span class="token string">&quot;<span class="token variable">$bin</span>&quot;</span><span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>

<span class="token builtin class-name">.</span> <span class="token string">&quot;<span class="token variable">$bin</span>&quot;</span>/config.sh

<span class="token assign-left variable">ENTRYPOINT</span><span class="token operator">=</span>standalonesession

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">==</span> <span class="token string">&quot;start&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">==</span> <span class="token string">&quot;start-foreground&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token comment"># Add JobManager-specific JVM options</span>
    <span class="token builtin class-name">export</span> <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS}</span> <span class="token variable">${FLINK_ENV_JAVA_OPTS_JM}</span>&quot;</span>
    parseJmArgsAndExportLogs <span class="token string">&quot;<span class="token variable">${ARGS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span>

    <span class="token comment"># 拼接jobmanager脚本的启动参数</span>
    <span class="token assign-left variable">args</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;--configDir&quot;</span> <span class="token string">&quot;<span class="token variable">${FLINK_CONF_DIR}</span>&quot;</span> <span class="token string">&quot;--executionMode&quot;</span> <span class="token string">&quot;cluster&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -z <span class="token variable">$HOST</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">args</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">&quot;--host&quot;</span><span class="token punctuation">)</span>
        <span class="token assign-left variable">args</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">${HOST}</span>&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">fi</span>

    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -z <span class="token variable">$WEBUIPORT</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">args</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">&quot;--webui-port&quot;</span><span class="token punctuation">)</span>
        <span class="token assign-left variable">args</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">${WEBUIPORT}</span>&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">fi</span>

    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -z <span class="token string">&quot;<span class="token variable">${DYNAMIC_PARAMETERS}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">args</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token variable">${DYNAMIC_PARAMETERS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token punctuation">)</span>
    <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">==</span> <span class="token string">&quot;start-foreground&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token comment"># 传入参数start-foreground，调用flink-console启动jobmanager</span>
    <span class="token builtin class-name">exec</span> <span class="token string">&quot;<span class="token variable">${FLINK_BIN_DIR}</span>&quot;</span>/flink-console.sh <span class="token variable">$ENTRYPOINT</span> <span class="token string">&quot;<span class="token variable">${args<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span>
<span class="token keyword">else</span>
    <span class="token string">&quot;<span class="token variable">${FLINK_BIN_DIR}</span>&quot;</span>/flink-daemon.sh <span class="token variable">$STARTSTOP</span> <span class="token variable">$ENTRYPOINT</span> <span class="token string">&quot;<span class="token variable">${args<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span>
<span class="token keyword">fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h4 id="_5-taskmanager-sh"><a href="#_5-taskmanager-sh" class="header-anchor">#</a> 5. taskmanager.sh</h4> <p>脚本taskmanger，启动work节点taskmanager，内容如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token comment"># Start/stop a Flink TaskManager.</span>
<span class="token assign-left variable">USAGE</span><span class="token operator">=</span><span class="token string">&quot;Usage: taskmanager.sh (start|start-foreground|stop|stop-all)&quot;</span>

<span class="token assign-left variable">STARTSTOP</span><span class="token operator">=</span><span class="token variable">$1</span>

<span class="token assign-left variable">ARGS</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">${@<span class="token operator">:</span>2}</span>&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">!=</span> <span class="token string">&quot;start&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">!=</span> <span class="token string">&quot;start-foreground&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">!=</span> <span class="token string">&quot;stop&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">!=</span> <span class="token string">&quot;stop-all&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token variable">$USAGE</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">bin</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">dirname</span> <span class="token string">&quot;<span class="token variable">$0</span>&quot;</span><span class="token variable">`</span></span>
<span class="token assign-left variable">bin</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">cd</span> <span class="token string">&quot;<span class="token variable">$bin</span>&quot;</span><span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>

<span class="token builtin class-name">.</span> <span class="token string">&quot;<span class="token variable">$bin</span>&quot;</span>/config.sh

<span class="token assign-left variable">ENTRYPOINT</span><span class="token operator">=</span>taskexecutor

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">==</span> <span class="token string">&quot;start&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">==</span> <span class="token string">&quot;start-foreground&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>

    <span class="token comment"># if no other JVM options are set, set the GC to G1</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS}</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS_TM}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">export</span> <span class="token assign-left variable">JVM_ARGS</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$JVM_ARGS</span> -XX:+UseG1GC&quot;</span>
    <span class="token keyword">fi</span>

    <span class="token comment"># Add TaskManager-specific JVM options</span>
    <span class="token builtin class-name">export</span> <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${FLINK_ENV_JAVA_OPTS}</span> <span class="token variable">${FLINK_ENV_JAVA_OPTS_TM}</span>&quot;</span>

    <span class="token comment"># Startup parameters</span>

    parseTmArgsAndExportLogs <span class="token string">&quot;<span class="token variable">${ARGS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span>

    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -z <span class="token string">&quot;<span class="token variable">${DYNAMIC_PARAMETERS}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">ARGS</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">${DYNAMIC_PARAMETERS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span> <span class="token string">&quot;<span class="token variable">${ARGS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">fi</span>

    <span class="token assign-left variable">ARGS</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;--configDir&quot;</span> <span class="token string">&quot;<span class="token variable">${FLINK_CONF_DIR}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${ARGS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$STARTSTOP</span> <span class="token operator">==</span> <span class="token string">&quot;start-foreground&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">exec</span> <span class="token string">&quot;<span class="token variable">${FLINK_BIN_DIR}</span>&quot;</span>/flink-console.sh <span class="token variable">$ENTRYPOINT</span> <span class="token string">&quot;<span class="token variable">${ARGS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span>
<span class="token keyword">else</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$FLINK_TM_COMPUTE_NUMA</span> <span class="token operator">==</span> <span class="token string">&quot;false&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment"># Start a single TaskManager</span>
        <span class="token string">&quot;<span class="token variable">${FLINK_BIN_DIR}</span>&quot;</span>/flink-daemon.sh <span class="token variable">$STARTSTOP</span> <span class="token variable">$ENTRYPOINT</span> <span class="token string">&quot;<span class="token variable">${ARGS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span>
    <span class="token keyword">else</span>
        <span class="token comment"># Example output from `numactl --show` on an AWS c4.8xlarge:</span>
        <span class="token comment"># policy: default</span>
        <span class="token comment"># preferred node: current</span>
        <span class="token comment"># physcpubind: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35</span>
        <span class="token comment"># cpubind: 0 1</span>
        <span class="token comment"># nodebind: 0 1</span>
        <span class="token comment"># membind: 0 1</span>
        <span class="token builtin class-name">read</span> -ra NODE_LIST <span class="token operator">&lt;&lt;&lt;</span> <span class="token variable"><span class="token variable">$(</span>numactl --show <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;^nodebind: &quot;</span><span class="token variable">)</span></span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">NODE_ID</span> <span class="token keyword">in</span> <span class="token string">&quot;<span class="token variable">${NODE_LIST<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token operator">:</span>1}</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
            <span class="token comment"># Start a TaskManager for each NUMA node</span>
            numactl --membind<span class="token operator">=</span><span class="token variable">$NODE_ID</span> --cpunodebind<span class="token operator">=</span><span class="token variable">$NODE_ID</span> -- <span class="token string">&quot;<span class="token variable">${FLINK_BIN_DIR}</span>&quot;</span>/flink-daemon.sh <span class="token variable">$STARTSTOP</span> <span class="token variable">$ENTRYPOINT</span> <span class="token string">&quot;<span class="token variable">${ARGS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span>
        <span class="token keyword">done</span>
    <span class="token keyword">fi</span>
<span class="token keyword">fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><h4 id="_6-flink-daemon-sh"><a href="#_6-flink-daemon-sh" class="header-anchor">#</a> 6. flink-daemon.sh</h4> <p>可以看到无论是启动jobmanager还是taskmanager都使用到了脚本<code>flink-daemon.sh</code>，只是传入的参数不同，jobmanager传入的参数为<code>standalonesession</code>，taskmanager传入的参数为taskexecutor，flink-daemon脚本的内容如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token comment"># Start/stop a Flink daemon.</span>
<span class="token assign-left variable">USAGE</span><span class="token operator">=</span><span class="token string">&quot;Usage: flink-daemon.sh (start|stop|stop-all) (taskexecutor|zookeeper|historyserver|standalonesession|standalonejob) [args]&quot;</span>

<span class="token assign-left variable">STARTSTOP</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">DAEMON</span><span class="token operator">=</span><span class="token variable">$2</span>
<span class="token assign-left variable">ARGS</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">${@<span class="token operator">:</span>3}</span>&quot;</span><span class="token punctuation">)</span> <span class="token comment"># get remaining arguments as array</span>

<span class="token assign-left variable">bin</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">dirname</span> <span class="token string">&quot;<span class="token variable">$0</span>&quot;</span><span class="token variable">`</span></span>
<span class="token assign-left variable">bin</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">cd</span> <span class="token string">&quot;<span class="token variable">$bin</span>&quot;</span><span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>

<span class="token builtin class-name">.</span> <span class="token string">&quot;<span class="token variable">$bin</span>&quot;</span>/config.sh

<span class="token keyword">case</span> <span class="token variable">$DAEMON</span> <span class="token keyword">in</span>
    <span class="token comment"># taskmanager对应的类为TaskManagerRunner</span>
    <span class="token punctuation">(</span>taskexecutor<span class="token punctuation">)</span>
        <span class="token assign-left variable">CLASS_TO_RUN</span><span class="token operator">=</span>org.apache.flink.runtime.taskexecutor.TaskManagerRunner
    <span class="token punctuation">;</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span>zookeeper<span class="token punctuation">)</span>
        <span class="token assign-left variable">CLASS_TO_RUN</span><span class="token operator">=</span>org.apache.flink.runtime.zookeeper.FlinkZooKeeperQuorumPeer
    <span class="token punctuation">;</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span>historyserver<span class="token punctuation">)</span>
        <span class="token assign-left variable">CLASS_TO_RUN</span><span class="token operator">=</span>org.apache.flink.runtime.webmonitor.history.HistoryServer
    <span class="token punctuation">;</span><span class="token punctuation">;</span>

    <span class="token comment"># jobmanager对应的类为StandaloneSessionClusterEntrypoint</span>
    <span class="token punctuation">(</span>standalonesession<span class="token punctuation">)</span>
        <span class="token assign-left variable">CLASS_TO_RUN</span><span class="token operator">=</span>org.apache.flink.runtime.entrypoint.StandaloneSessionClusterEntrypoint
    <span class="token punctuation">;</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span>standalonejob<span class="token punctuation">)</span>
        <span class="token assign-left variable">CLASS_TO_RUN</span><span class="token operator">=</span>org.apache.flink.container.entrypoint.StandaloneApplicationClusterEntryPoint
    <span class="token punctuation">;</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span>*<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;Unknown daemon '<span class="token variable">${DAEMON}</span>'. <span class="token variable">$USAGE</span>.&quot;</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$FLINK_IDENT_STRING</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">FLINK_IDENT_STRING</span><span class="token operator">=</span><span class="token string">&quot;<span class="token environment constant">$USER</span>&quot;</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">FLINK_TM_CLASSPATH</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>constructFlinkClassPath<span class="token variable">`</span></span>

<span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token variable">$FLINK_PID_DIR</span>/flink-<span class="token variable">$FLINK_IDENT_STRING</span>-<span class="token variable">$DAEMON</span>.pid

<span class="token function">mkdir</span> -p <span class="token string">&quot;<span class="token variable">$FLINK_PID_DIR</span>&quot;</span>

<span class="token comment"># Log files for daemons are indexed from the process ID's position in the PID</span>
<span class="token comment"># file. The following lock prevents a race condition during daemon startup</span>
<span class="token comment"># when multiple daemons read, index, and write to the PID file concurrently.</span>
<span class="token comment"># The lock is created on the PID directory since a lock file cannot be safely</span>
<span class="token comment"># removed. The daemon is started with the lock closed and the lock remains</span>
<span class="token comment"># active in this script until the script exits.</span>
<span class="token builtin class-name">command</span> -v flock <span class="token operator">&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">exec</span> <span class="token number">20</span><span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span><span class="token string">&quot;<span class="token variable">$FLINK_PID_DIR</span>&quot;</span>
    flock <span class="token number">200</span>
<span class="token keyword">fi</span>

<span class="token comment"># Ascending ID depending on number of lines in pid file.</span>
<span class="token comment"># This allows us to start multiple daemon of each type.</span>
<span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token punctuation">[</span> -f <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token punctuation">$(</span>wc -l <span class="token operator">&lt;</span> <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;0&quot;</span><span class="token variable">)</span></span>

<span class="token assign-left variable">FLINK_LOG_PREFIX</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${FLINK_LOG_DIR}</span>/flink-<span class="token variable">${FLINK_IDENT_STRING}</span>-<span class="token variable">${DAEMON}</span>-<span class="token variable">${id}</span>-<span class="token variable">${<span class="token environment constant">HOSTNAME</span>}</span>&quot;</span>
<span class="token assign-left variable">log</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${FLINK_LOG_PREFIX}</span>.log&quot;</span>
<span class="token assign-left variable">out</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${FLINK_LOG_PREFIX}</span>.out&quot;</span>

<span class="token assign-left variable">log_setting</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;-Dlog.file=<span class="token variable">${log}</span>&quot;</span> <span class="token string">&quot;-Dlog4j.configuration=file:<span class="token variable">${FLINK_CONF_DIR}</span>/log4j.properties&quot;</span> <span class="token string">&quot;-Dlog4j.configurationFile=file:<span class="token variable">${FLINK_CONF_DIR}</span>/log4j.properties&quot;</span> <span class="token string">&quot;-Dlogback.configurationFile=file:<span class="token variable">${FLINK_CONF_DIR}</span>/logback.xml&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function-name function">guaranteed_kill</span> <span class="token punctuation">{</span>
  <span class="token assign-left variable">to_stop_pid</span><span class="token operator">=</span><span class="token variable">$1</span>
  <span class="token assign-left variable">daemon</span><span class="token operator">=</span><span class="token variable">$2</span>

  <span class="token comment"># send sigterm for graceful shutdown</span>
  <span class="token function">kill</span> <span class="token variable">$to_stop_pid</span>
  <span class="token comment"># if timeout exists, use it</span>
  <span class="token keyword">if</span> <span class="token builtin class-name">command</span> -v <span class="token function">timeout</span> <span class="token operator">&amp;&gt;</span> /dev/null <span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token comment"># wait 10 seconds for process to stop. By default, Flink kills the JVM 5 seconds after sigterm.</span>
    <span class="token function">timeout</span> <span class="token number">10</span> <span class="token function">tail</span> --pid<span class="token operator">=</span><span class="token variable">$to_stop_pid</span> -f /dev/null <span class="token operator">&amp;&gt;</span> /dev/null
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$?</span>&quot;</span> -eq <span class="token number">124</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
      <span class="token builtin class-name">echo</span> <span class="token string">&quot;Daemon <span class="token variable">$daemon</span> didn't stop within 10 seconds. Killing it.&quot;</span>
      <span class="token comment"># send sigkill</span>
      <span class="token function">kill</span> -9 <span class="token variable">$to_stop_pid</span>
    <span class="token keyword">fi</span>
  <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token keyword">case</span> <span class="token variable">$STARTSTOP</span> <span class="token keyword">in</span>

    <span class="token punctuation">(</span>start<span class="token punctuation">)</span>

        <span class="token comment"># Print a warning if daemons are already running on host</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
          <span class="token assign-left variable">active</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">while</span> <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">''</span> <span class="token builtin class-name">read</span> -r p <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$p</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
            <span class="token function">kill</span> -0 <span class="token variable">$p</span> <span class="token operator">&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
            <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
              <span class="token assign-left variable">active</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span>
            <span class="token keyword">fi</span>
          <span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token string">&quot;<span class="token variable">${pid}</span>&quot;</span>

          <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${<span class="token operator">#</span>active<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span>

          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">${count}</span> -gt <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">echo</span> <span class="token string">&quot;[INFO] <span class="token variable">$count</span> instance(s) of <span class="token variable">$DAEMON</span> are already running on <span class="token environment constant">$HOSTNAME</span>.&quot;</span>
          <span class="token keyword">fi</span>
        <span class="token keyword">fi</span>

        <span class="token comment"># Evaluate user options for local variable expansion</span>
        <span class="token assign-left variable">FLINK_ENV_JAVA_OPTS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">eval</span> <span class="token builtin class-name">echo</span> $<span class="token punctuation">{</span>FLINK_ENV_JAVA_OPTS<span class="token punctuation">}</span><span class="token variable">)</span></span>

        <span class="token builtin class-name">echo</span> <span class="token string">&quot;Starting <span class="token variable">$DAEMON</span> daemon on host <span class="token environment constant">$HOSTNAME</span>.&quot;</span>
        <span class="token string">&quot;<span class="token variable">$JAVA_RUN</span>&quot;</span> <span class="token variable">$JVM_ARGS</span> <span class="token variable">${FLINK_ENV_JAVA_OPTS}</span> <span class="token string">&quot;<span class="token variable">${log_setting<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span> -classpath <span class="token string">&quot;<span class="token variable"><span class="token variable">`</span>manglePathList <span class="token string">&quot;<span class="token variable">$FLINK_TM_CLASSPATH</span>:<span class="token variable">$INTERNAL_HADOOP_CLASSPATHS</span>&quot;</span><span class="token variable">`</span></span>&quot;</span> <span class="token variable">${CLASS_TO_RUN}</span> <span class="token string">&quot;<span class="token variable">${ARGS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span> <span class="token operator">&gt;</span> <span class="token string">&quot;<span class="token variable">$out</span>&quot;</span> <span class="token number">20</span><span class="token operator"><span class="token file-descriptor important">0</span>&lt;&amp;</span>- <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&lt;</span> /dev/null <span class="token operator">&amp;</span>

        <span class="token assign-left variable">mypid</span><span class="token operator">=</span><span class="token variable">$!</span>

        <span class="token comment"># Add to pid file if successful start</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">${mypid}</span> <span class="token operator">=~</span> <span class="token variable">${IS_NUMBER}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">kill</span> -0 <span class="token variable">$mypid</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">echo</span> <span class="token variable">$mypid</span> <span class="token operator">&gt;&gt;</span> <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span>
        <span class="token keyword">else</span>
            <span class="token builtin class-name">echo</span> <span class="token string">&quot;Error starting <span class="token variable">$DAEMON</span> daemon.&quot;</span>
            <span class="token builtin class-name">exit</span> <span class="token number">1</span>
        <span class="token keyword">fi</span>
    <span class="token punctuation">;</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span>stop<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token comment"># Remove last in pid file</span>
            <span class="token assign-left variable">to_stop</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">tail</span> -n <span class="token number">1</span> <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span><span class="token variable">)</span></span>

            <span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token variable">$to_stop</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token function">rm</span> <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span> <span class="token comment"># If all stopped, clean up pid file</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot;No <span class="token variable">$DAEMON</span> daemon to stop on host <span class="token environment constant">$HOSTNAME</span>.&quot;</span>
            <span class="token keyword">else</span>
                <span class="token function">sed</span> <span class="token punctuation">\</span><span class="token variable">$d</span> <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span> <span class="token operator">&gt;</span> <span class="token string">&quot;<span class="token variable">$pid</span>.tmp&quot;</span> <span class="token comment"># all but last line</span>

                <span class="token comment"># If all stopped, clean up pid file</span>
                <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">wc</span> -l <span class="token operator">&lt;</span> <span class="token string">&quot;<span class="token variable">$pid</span>.tmp&quot;</span><span class="token variable">)</span></span> -eq <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$pid</span>.tmp&quot;</span> <span class="token operator">||</span> <span class="token function">mv</span> <span class="token string">&quot;<span class="token variable">$pid</span>.tmp&quot;</span> <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span>

                <span class="token keyword">if</span> <span class="token function">kill</span> -0 <span class="token variable">$to_stop</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Stopping <span class="token variable">$DAEMON</span> daemon (pid: <span class="token variable">$to_stop</span>) on host <span class="token environment constant">$HOSTNAME</span>.&quot;</span>
                    guaranteed_kill <span class="token variable">$to_stop</span> <span class="token variable">$DAEMON</span>
                <span class="token keyword">else</span>
                    <span class="token builtin class-name">echo</span> <span class="token string">&quot;No <span class="token variable">$DAEMON</span> daemon (pid: <span class="token variable">$to_stop</span>) is running anymore on <span class="token environment constant">$HOSTNAME</span>.&quot;</span>
                <span class="token keyword">fi</span>
            <span class="token keyword">fi</span>
        <span class="token keyword">else</span>
            <span class="token builtin class-name">echo</span> <span class="token string">&quot;No <span class="token variable">$DAEMON</span> daemon to stop on host <span class="token environment constant">$HOSTNAME</span>.&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token punctuation">;</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span>stop-all<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token function">mv</span> <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${pid}</span>.tmp&quot;</span>

            <span class="token keyword">while</span> <span class="token builtin class-name">read</span> to_stop<span class="token punctuation">;</span> <span class="token keyword">do</span>
                <span class="token keyword">if</span> <span class="token function">kill</span> -0 <span class="token variable">$to_stop</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Stopping <span class="token variable">$DAEMON</span> daemon (pid: <span class="token variable">$to_stop</span>) on host <span class="token environment constant">$HOSTNAME</span>.&quot;</span>
                    guaranteed_kill <span class="token variable">$to_stop</span> <span class="token variable">$DAEMON</span>
                <span class="token keyword">else</span>
                    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Skipping <span class="token variable">$DAEMON</span> daemon (pid: <span class="token variable">$to_stop</span>), because it is not running anymore on <span class="token environment constant">$HOSTNAME</span>.&quot;</span>
                <span class="token keyword">fi</span>
            <span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token string">&quot;<span class="token variable">${pid}</span>.tmp&quot;</span>
            <span class="token function">rm</span> <span class="token string">&quot;<span class="token variable">${pid}</span>.tmp&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token punctuation">;</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span>*<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;Unexpected argument '<span class="token variable">$STARTSTOP</span>'. <span class="token variable">$USAGE</span>.&quot;</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token punctuation">;</span><span class="token punctuation">;</span>

<span class="token keyword">esac</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br></div></div><h4 id="_7-总结"><a href="#_7-总结" class="header-anchor">#</a> 7. 总结</h4> <p>可以看出flink集群在启动时，需要通过<code>config.sh</code>脚本加载许多的配置，为后续提供基本保障。大概启动流程从<code>start-cluster</code>开始，通过<code>flink-daemon</code>脚本启动jobmanager和taskmanager。下面我们具体分析一下调用<code>flink-daemon</code>脚本时所启动的<code>StandaloneSessionClusterEntrypoint</code>类和<code>TaskManagerRunner</code>类的执行流程。</p></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=Flink" title="标签">#Flink</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/3f76c3/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">《从0学习Flink源码》——构建源码测试环境</div></a> <a href="/pages/128d25/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">《从0学习Flink源码》——JobManager启动过程</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/3f76c3/" class="prev">《从0学习Flink源码》——构建源码测试环境</a></span> <span class="next"><a href="/pages/128d25/">《从0学习Flink源码》——JobManager启动过程</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/78d1d9/"><div>
            深入理解Java虚拟机
            <!----></div></a> <span class="date">07-29</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/19ee33/"><div>
            Flink中的多流转换
            <!----></div></a> <span class="date">07-12</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/81a0f9/"><div>
            Flink中Time和Window
            <!----></div></a> <span class="date">07-11</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:yangqi199808@foxmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Yanko24" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://blog.csdn.net/weixin_43495317?spm=1000.2115.3001.5343" title="CSDN" target="_blank" class="iconfont icon-csdn"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>从零学习大数据</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.69860091.js" defer></script><script src="/assets/js/2.5a5d1011.js" defer></script><script src="/assets/js/251.221ffd29.js" defer></script>
  </body>
</html>
